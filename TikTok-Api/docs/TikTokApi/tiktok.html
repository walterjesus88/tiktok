<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 7.2.0" />
    <title>TikTokApi.tiktok API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{display:none;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{--shift:-40px;text-align:right;margin-top:var(--shift);margin-bottom:calc(0px - var(--shift));clear:both;filter:opacity(1);}.pdoc details:not([open]){height:0;overflow:visible;}.pdoc details > summary{font-size:.75rem;cursor:pointer;color:var(--muted);border-width:0;padding:0 .7em;display:inline-block;display:inline list-item;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc details > div{margin-top:calc(0px - var(--shift) / 2);text-align:left;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:3rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:1rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox">
            <div>
                        <a class="pdoc-button module-list-button" href="../TikTokApi.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;TikTokApi</a>

                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>




                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="class" href="#TikTokApi">TikTokApi</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TikTokApi.__init__">TikTokApi</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_instance">get_instance</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.clean_up">clean_up</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.external_signer">external_signer</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_data">get_data</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_cookies">get_cookies</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_bytes">get_bytes</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.by_trending">by_trending</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.search_for_users">search_for_users</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.search_for_music">search_for_music</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.search_for_hashtags">search_for_hashtags</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.discover_type">discover_type</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.user_posts">user_posts</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.by_username">by_username</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.user_page">user_page</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_user_pager">get_user_pager</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.user_liked">user_liked</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.user_liked_by_username">user_liked_by_username</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.by_sound">by_sound</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.by_sound_page">by_sound_page</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_music_object">get_music_object</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_music_object_full">get_music_object_full</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_music_object_full_by_api">get_music_object_full_by_api</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.by_hashtag">by_hashtag</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_hashtag_object">get_hashtag_object</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_recommended_tiktoks_by_video_id">get_recommended_tiktoks_by_video_id</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_tiktok_by_id">get_tiktok_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_tiktok_by_url">get_tiktok_by_url</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_tiktok_by_html">get_tiktok_by_html</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_user_object">get_user_object</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_user">get_user</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_video_by_tiktok">get_video_by_tiktok</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_video_by_download_url">get_video_by_download_url</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_video_by_url">get_video_by_url</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_video_no_watermark">get_video_no_watermark</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_music_title">get_music_title</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.get_secuid">get_secuid</a>
                        </li>
                        <li>
                                <a class="function" href="#TikTokApi.generate_device_id">generate_device_id</a>
                        </li>
                </ul>

            </li>
    </ul>


                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../TikTokApi.html">TikTokApi</a><wbr>.tiktok    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span><span class="p">,</span> <span class="n">urlencode</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">playwright.sync_api</span> <span class="kn">import</span> <span class="n">sync_playwright</span>

<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.utilities</span> <span class="kn">import</span> <span class="n">update_messager</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;no_proxy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1,localhost&quot;</span>

<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://m.tiktok.com/&quot;</span>


<span class="k">class</span> <span class="nc">TikTokApi</span><span class="p">:</span>
    <span class="n">__instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The TikTokApi class. Used to interact with TikTok, use get_instance NOT this.&quot;&quot;&quot;</span>
        <span class="c1"># Forces Singleton</span>
        <span class="k">if</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only one TikTokApi object is allowed&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logging_level&quot;</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Class initalized&quot;</span><span class="p">)</span>

        <span class="c1"># Some Instance Vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executablePath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executablePath&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_did&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please use custom_device_id instead of custom_device_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) &quot;</span>
            <span class="s2">&quot;AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span>
            <span class="s2">&quot;Chrome/86.0.4240.111 Safari/537.36&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;external_signer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request_delay&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;requests_extra_kwargs&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_test_endpoints&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">BASE_URL</span>
            <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://t.tiktok.com/&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_selenium&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.browser_utilities.browser_selenium</span> <span class="kn">import</span> <span class="n">browser</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.browser_utilities.browser</span> <span class="kn">import</span> <span class="n">browser</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;generate_static_device_id&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">browser</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">timezone_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">browser_language</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">height</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">region</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">language</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;An error ocurred while opening your browser but it was ignored.&quot;</span>
            <span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Are you sure you ran python -m playwright install&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;1920&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="s2">&quot;1080&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;US&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The TikTokApi class. Used to interact with TikTok. This is a singleton</span>
<span class="sd">            class to prevent issues from arising with playwright</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * logging_level: The logging level you want the program to run at, optional</span>
<span class="sd">            These are the standard python logging module&#39;s levels.</span>

<span class="sd">        * request_delay: The amount of time in seconds to wait before making a request, optional</span>
<span class="sd">            This is used to throttle your own requests as you may end up making too</span>
<span class="sd">            many requests to TikTok for your IP.</span>

<span class="sd">        * custom_device_id: A TikTok parameter needed to download videos, optional</span>
<span class="sd">            The code generates these and handles these pretty well itself, however</span>
<span class="sd">            for some things such as video download you will need to set a consistent</span>
<span class="sd">            one of these. All the methods take this as a optional parameter, however</span>
<span class="sd">            it&#39;s cleaner code to store this at the instance level. You can override</span>
<span class="sd">            this at the specific methods.</span>

<span class="sd">        * generate_static_device_id: A parameter that generates a custom_device_id at the instance level</span>
<span class="sd">            Use this if you want to download videos from a script but don&#39;t want to generate</span>
<span class="sd">            your own custom_device_id parameter.</span>

<span class="sd">        * custom_verifyFp: A TikTok parameter needed to work most of the time, optional</span>
<span class="sd">            To get this parameter look at [this video](https://youtu.be/zwLmLfVI-VQ?t=117)</span>
<span class="sd">            I recommend watching the entire thing, as it will help setup this package. All</span>
<span class="sd">            the methods take this as a optional parameter, however it&#39;s cleaner code</span>
<span class="sd">            to store this at the instance level. You can override this at the specific</span>
<span class="sd">            methods.</span>

<span class="sd">            You can use the following to generate `&quot;&quot;.join(random.choice(string.digits)</span>
<span class="sd">            for num in range(19))`</span>

<span class="sd">        * use_test_endpoints: Send requests to TikTok&#39;s test endpoints, optional</span>
<span class="sd">            This parameter when set to true will make requests to TikTok&#39;s testing</span>
<span class="sd">            endpoints instead of the live site. I can&#39;t guarantee this will work</span>
<span class="sd">            in the future, however currently basically any custom_verifyFp will</span>
<span class="sd">            work here which is helpful.</span>

<span class="sd">        * proxy: A string containing your proxy address, optional</span>
<span class="sd">            If you want to do a lot of scraping of TikTok endpoints you&#39;ll likely</span>
<span class="sd">            need a proxy.</span>

<span class="sd">            Ex: &quot;https://0.0.0.0:8080&quot;</span>

<span class="sd">            All the methods take this as a optional parameter, however it&#39;s cleaner code</span>
<span class="sd">            to store this at the instance level. You can override this at the specific</span>
<span class="sd">            methods.</span>

<span class="sd">        * use_selenium: Option to use selenium over playwright, optional</span>
<span class="sd">            Playwright is selected by default and is the one that I&#39;m designing the</span>
<span class="sd">            package to be compatable for, however if playwright doesn&#39;t work on</span>
<span class="sd">            your machine feel free to set this to True.</span>

<span class="sd">        * executablePath: The location of the driver, optional</span>
<span class="sd">            This shouldn&#39;t be needed if you&#39;re using playwright</span>

<span class="sd">        * **kwargs</span>
<span class="sd">            Parameters that are passed on to basically every module and methods</span>
<span class="sd">            that interact with this main class. These may or may not be documented</span>
<span class="sd">            in other places.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span><span class="p">:</span>
            <span class="n">TikTokApi</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span>

    <span class="k">def</span> <span class="nf">clean_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A basic cleanup method, called automatically from the code&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A basic cleanup method, called automatically from the code&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">clean_up</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">get_playwright</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">external_signer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">custom_device_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verifyFp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes requests to an external signer instead of using a browser.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The server to make requests to</span>
<span class="sd">            This server is designed to sign requests. You can find an example</span>
<span class="sd">            of this signature server in the examples folder.</span>

<span class="sd">        * custom_device_id: A TikTok parameter needed to download videos</span>
<span class="sd">            The code generates these and handles these pretty well itself, however</span>
<span class="sd">            for some things such as video download you will need to set a consistent</span>
<span class="sd">            one of these.</span>

<span class="sd">        * custom_verifyFp: A TikTok parameter needed to work most of the time,</span>
<span class="sd">            To get this parameter look at [this video](https://youtu.be/zwLmLfVI-VQ?t=117)</span>
<span class="sd">            I recommend watching the entire thing, as it will help setup this package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">custom_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;custom_device_id&quot;</span><span class="p">:</span> <span class="n">custom_device_id</span><span class="p">,</span>
                <span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="o">+</span> <span class="s2">&quot;?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;_signature&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;userAgent&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;referrer&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Makes requests to TikTok and returns their JSON.</span>

<span class="sd">        This is all handled by the package so it&#39;s unlikely</span>
<span class="sd">        you will need to use this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="s2">&quot;verify_khr3jabg_V7ucdslq_Vrw9_4KPb_AJ1b_Ks706M8zIJTq&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>

        <span class="n">tt_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">send_tt_params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;send_tt_params&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verifyFp</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">tt_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">sign_url</span><span class="p">(</span>
                <span class="n">calc_tt_params</span><span class="o">=</span><span class="n">send_tt_params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>
            <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">referrer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">userAgent</span><span class="p">,</span> <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_signer</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
                <span class="n">custom_device_id</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">),</span>
                <span class="n">verifyFp</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">,</span> <span class="n">verifyFp</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;send_tt_params&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">tt_params</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verify_fp</span><span class="p">,</span> <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span> <span class="s2">&quot;_signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x-secsdk-csrf-version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;x-secsdk-csrf-request&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">csrf_session_id</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">]</span>
        <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Ware-Csrf-Token&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csrf_session_id</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;authority&quot;</span><span class="p">:</span> <span class="s2">&quot;m.tiktok.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;tiktok.com&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json, text/plain, */*&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate, br&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept-language&quot;</span><span class="p">:</span> <span class="s2">&quot;en-US,en;q=0.9&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="n">referrer</span><span class="p">,</span>
            <span class="s2">&quot;referer&quot;</span><span class="p">:</span> <span class="n">referrer</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-dest&quot;</span><span class="p">:</span> <span class="s2">&quot;empty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-mode&quot;</span><span class="p">:</span> <span class="s2">&quot;cors&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-site&quot;</span><span class="p">:</span> <span class="s2">&quot;same-site&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-gpc&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user-agent&quot;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
            <span class="s2">&quot;x-secsdk-csrf-token&quot;</span><span class="p">:</span> <span class="n">csrf_token</span><span class="p">,</span>
            <span class="s2">&quot;x-tt-params&quot;</span><span class="p">:</span> <span class="n">tt_params</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GET: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">headers: </span><span class="si">{</span><span class="n">headers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;verify&quot;</span>
                <span class="ow">or</span> <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verifyConfig&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;verify&quot;</span>
            <span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Tiktok wants to display a catcha. Response is:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>
            
            <span class="c1"># statusCode from props-&gt;pageProps-&gt;statusCode thanks @adiantek on #403</span>
            <span class="n">error_codes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;450&quot;</span><span class="p">:</span> <span class="s2">&quot;CLIENT_PAGE_ERROR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10000&quot;</span><span class="p">:</span> <span class="s2">&quot;VERIFY_CODE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10101&quot;</span><span class="p">:</span> <span class="s2">&quot;SERVER_ERROR_NOT_500&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10102&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_NOT_LOGIN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10111&quot;</span><span class="p">:</span> <span class="s2">&quot;NET_ERROR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10113&quot;</span><span class="p">:</span> <span class="s2">&quot;SHARK_SLIDE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10114&quot;</span><span class="p">:</span> <span class="s2">&quot;SHARK_BLOCK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10119&quot;</span><span class="p">:</span> <span class="s2">&quot;LIVE_NEED_LOGIN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10202&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10203&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10204&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10205&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10208&quot;</span><span class="p">:</span> <span class="s2">&quot;EFFECT_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10209&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_BLACK_LIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10210&quot;</span><span class="p">:</span> <span class="s2">&quot;LIVE_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10211&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_SENSITIVITY_WORD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10212&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10213&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_LOW_AGE_M&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10214&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_LOW_AGE_T&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10215&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_ABNORMAL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10216&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_PRIVATE_BY_USER&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10217&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_FIRST_REVIEW_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10218&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10219&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_NO_COPYRIGHT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10220&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_UNSHELVE_BY_MUSIC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10221&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_BAN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10222&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_PRIVATE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10223&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_FTC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10224&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10225&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_UNIQUE_SENSITIVITY&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10227&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_NEED_RECHECK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10228&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_RISK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10229&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_R_MASK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10230&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_RISK_MASK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10231&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_GEOFENCE_BLOCK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10404&quot;</span><span class="p">:</span> <span class="s2">&quot;FYP_VIDEO_LIST_LIMIT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;undefined&quot;</span><span class="p">:</span> <span class="s2">&quot;MEDIA_ERROR&quot;</span>
            <span class="p">}</span>
            <span class="n">statusCode</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;statusCode&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TikTok Returned: </span><span class="si">{</span><span class="n">json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">statusCode</span> <span class="o">==</span> <span class="mi">10201</span><span class="p">:</span>
                <span class="c1"># Invalid Entity</span>
                <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span>
                    <span class="s2">&quot;TikTok returned a response indicating the entity is invalid&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">statusCode</span> <span class="o">==</span> <span class="mi">10219</span><span class="p">:</span>
                <span class="c1"># not available in this region</span>
                <span class="k">raise</span> <span class="n">TikTokNotAvailableError</span><span class="p">(</span><span class="s2">&quot;Content not available for this region&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statusCode</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">statusCode</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GenericTikTokError</span><span class="p">(</span><span class="n">error_codes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">statusCode</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TikTok sent an unknown StatusCode of </span><span class="si">{</span><span class="n">statusCode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response: &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">EmptyResponseError</span><span class="p">(</span>
                    <span class="s2">&quot;Empty response from Tiktok to &quot;</span> <span class="o">+</span> <span class="n">url</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Converting response to JSON failed&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">JSONDecodeFailure</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">def</span> <span class="nf">get_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extracts cookies from the kwargs passed to the function for get_data&quot;&quot;&quot;</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="s2">&quot;verify_khr3jabg_V7ucdslq_Vrw9_4KPb_AJ1b_Ks706M8zIJTq&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_verify_fp_on_cookie_header&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;tt_webid&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;tt_webid_v2&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;csrf_session_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;tt_csrf_token&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;s_v_web_id&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">,</span>
                <span class="s2">&quot;ttwid&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ttwid&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;tt_webid&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;tt_webid_v2&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;csrf_session_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;tt_csrf_token&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;ttwid&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ttwid&quot;</span><span class="p">)</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns TikTok&#39;s response as bytes, similar to get_data&quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">sign_url</span><span class="p">(</span>
                <span class="n">calc_tt_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>
            <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">referrer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">userAgent</span><span class="p">,</span> <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_signer</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">custom_device_id</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verify_fp</span><span class="p">,</span> <span class="s2">&quot;_signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;*/*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;identity;q=1, *;q=0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Language&quot;</span><span class="p">:</span> <span class="s2">&quot;en-US;en;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Cache-Control&quot;</span><span class="p">:</span> <span class="s2">&quot;no-cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;Pragma&quot;</span><span class="p">:</span> <span class="s2">&quot;no-cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Range&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes=0-&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Referer&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.tiktok.com/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">by_trending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets trending TikToks</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * count: The amount of TikToks you want returned, optional</span>

<span class="sd">            Note: TikTok seems to only support at MOST ~2000 TikToks</span>
<span class="sd">            from a single endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        
        <span class="n">spawn</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com&quot;</span><span class="p">,</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span>
        <span class="p">)</span>
        <span class="n">ttwid</span> <span class="o">=</span> <span class="n">spawn</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s2">&quot;ttwid&quot;</span><span class="p">]</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s2">&quot;itemID&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;insertedItemID&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/recommend/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">ttwid</span><span class="o">=</span><span class="n">ttwid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">search_for_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of users that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for users by</span>
<span class="sd">            This string is the term you want to search for users by.</span>

<span class="sd">        * count: The number of users to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span><span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_for_music</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of music that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for music by</span>
<span class="sd">            This string is the term you want to search for music by.</span>

<span class="sd">        * count: The number of music to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span><span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;music&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_for_hashtags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of hashtags that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for music by</span>
<span class="sd">            This string is the term you want to search for music by.</span>

<span class="sd">        * count: The number of music to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span>
            <span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;challenge&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">discover_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of whatever the prefix type you pass in</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search by</span>

<span class="sd">        * prefix: The prefix of what to search for</span>

<span class="sd">        * count: The number search results to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;discoverType&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;needItemList&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;keyWord&quot;</span><span class="p">:</span> <span class="n">search_term</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;useRecommend&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/discover/</span><span class="si">{}</span><span class="s2">/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;userInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;userInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;musicInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;musicInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;challengeInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;challengeInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok is not sending videos beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">offset</span> <span class="o">+=</span> <span class="n">maxCount</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">user_posts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns an array of dictionaries representing TikToks for a user.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">userID</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="n">secUID</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/post/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;itemList&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks given a user&#39;s username.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the TikTok user to get TikToks from</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_posts</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">user_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing of one page of TikToks given a user&#39;s ID and secUID</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * page_size: The number of posts to return per page</span>

<span class="sd">            Gets a specific page of a user, doesn&#39;t iterate.</span>
<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">api_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">BASE_URL</span> <span class="o">+</span> <span class="s2">&quot;api/post/item_list/?</span><span class="si">{}</span><span class="s2">&amp;count=</span><span class="si">{}</span><span class="s2">&amp;id=</span><span class="si">{}</span><span class="s2">&amp;type=1&amp;secUid=</span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&amp;cursor=</span><span class="si">{}</span><span class="s2">&amp;sourceType=8&amp;appId=1233&amp;region=</span><span class="si">{}</span><span class="s2">&amp;language=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span>
                <span class="n">page_size</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">userID</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">secUID</span><span class="p">),</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">region</span><span class="p">,</span>
                <span class="n">language</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_user_pager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a generator to page through a user&#39;s feed</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>

<span class="sd">        * page_size: The number of posts to return in a page</span>

<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_page</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
                <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;itemList&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># No mo results</span>
                <span class="k">return</span>

            <span class="n">cursor</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="k">yield</span> <span class="n">page</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;hasMore&quot;</span><span class="p">]:</span>
                <span class="k">return</span>  <span class="c1"># all done</span>

    <span class="k">def</span> <span class="nf">user_liked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks that a given a user has liked.</span>
<span class="sd">            Note: The user&#39;s likes must be public</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">userID</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="n">secUID</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/favorite/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="s2">&quot;itemList&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User&#39;s likes are most likely private&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">user_liked_by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks a user has liked by username.</span>
<span class="sd">            Note: The user&#39;s likes must be public</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_liked</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">by_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks with a specific sound.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to search by</span>

<span class="sd">            Note: Can be found in the URL of the sound specific page or with other methods.</span>
<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;musicID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">realCount</span><span class="p">),</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;shareUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/music/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">by_sound_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a page of tiktoks with a specific sound.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id: The sound id to search by</span>
<span class="sd">            Note: Can be found in the URL of the sound specific page or with other methods.</span>
<span class="sd">        cursor: offset for pagination</span>
<span class="sd">        page_size: The number of posts to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;musicID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">page_size</span><span class="p">),</span>
            <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/music/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_music_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_music_object_full</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="s2">&quot;music&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_music_object_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com/music/-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">][</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_music_object_full_by_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id, but using the API rather than HTML requests.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">node/share/music/-</span><span class="si">{}</span><span class="s2">?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;statusCode&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10203</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">by_hashtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashtag</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks with a specific hashtag.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * hashtag: The hashtag to search by</span>

<span class="sd">            Without the # symbol</span>

<span class="sd">            A valid string is &quot;funny&quot;</span>
<span class="sd">        * count: The number of posts to return</span>
<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hashtag_object</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)[</span><span class="s2">&quot;challengeInfo&quot;</span><span class="p">][</span><span class="s2">&quot;challenge&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">required_count</span> <span class="o">=</span> <span class="n">count</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">required_count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">maxCount</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;challengeID&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/challenge/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">offset</span> <span class="o">+=</span> <span class="n">maxCount</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">required_count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_hashtag_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashtag</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a hashtag object.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * hashtag: The hashtag to search by</span>

<span class="sd">            Without the # symbol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">hashtag</span><span class="p">,</span> <span class="s2">&quot;isName&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">node/share/tag/</span><span class="si">{}</span><span class="s2">?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="n">quote</span><span class="p">(</span><span class="n">hashtag</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;challengeInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;challenge&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;Challenge </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hashtag</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_recommended_tiktoks_by_video_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing reccomended TikToks for a specific TikTok video.</span>


<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The id of the video to get suggestions for</span>

<span class="sd">            Can be found using other methods</span>
<span class="sd">        * count: The count of results you want to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/recommend/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_tiktok_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of a specific TikTok.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The id of the TikTok you want to get the object for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;itemId&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/item/detail/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_tiktok_by_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of a TikTok object by url.</span>


<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The TikTok url you want to retrieve</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">url</span>

        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">custom_device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">and</span> <span class="s2">&quot;/video/&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">post_id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/video/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;URL format not supported. Below is an example of a supported url.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;https://www.tiktok.com/@therock/video/6829267836783971589&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tiktok_by_id</span><span class="p">(</span>
            <span class="n">post_id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_tiktok_by_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This method retrieves a TikTok using the html</span>
<span class="sd">        endpoints rather than the API based ones.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The url of the TikTok to get</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;tiktok.com&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response is empty&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response: </span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;serverCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;TikTok with that url doesn&#39;t exist&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_user_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets a user object (dictionary)</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="s2">&quot;userInfo&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the full exposed user object</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://tiktok.com/@</span><span class="si">{}</span><span class="s2">?lang=en&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/@</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Tiktok response is empty&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Tiktok response: </span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>

        <span class="n">user</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;serverCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span>
                <span class="s2">&quot;TikTok user with username </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">user</span>

    <span class="k">def</span> <span class="nf">get_video_by_tiktok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads video from TikTok using a TikTok object.</span>

<span class="sd">        You will need to set a custom_device_id to do this for anything but trending.</span>
<span class="sd">        To do this, this is pretty simple you can either generate one yourself or,</span>
<span class="sd">        you can pass the generate_static_device_id=True into the constructor of the</span>
<span class="sd">        TikTokApi class.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * data: A TikTok object</span>

<span class="sd">            A TikTok JSON object from any other method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;downloadAddr&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;itemInfos&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;urls&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;itemInfo&quot;</span><span class="p">][</span><span class="s2">&quot;itemStruct&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;playAddr&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_video_by_download_url</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_video_by_download_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads video from TikTok using download url in a TikTok object</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * download_url: The download url key value in a TikTok object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_video_by_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads a TikTok video by a URL</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * video_url: The TikTok url to download the video from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">tiktok_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tiktok_by_url</span><span class="p">(</span><span class="n">video_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">download_url</span> <span class="o">=</span> <span class="n">tiktok_schema</span><span class="p">[</span><span class="s2">&quot;itemInfo&quot;</span><span class="p">][</span><span class="s2">&quot;itemStruct&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;downloadAddr&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_video_no_watermark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_url</span><span class="p">,</span> <span class="n">return_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the video with no watermark</span>
<span class="sd">        .. deprecated::</span>

<span class="sd">        Deprecated due to TikTok fixing this</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * video_url: The url of the video you want to download</span>

<span class="sd">        * return_bytes: Set this to 0 if you want url, 1 if you want bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Deprecated method, TikTok fixed this.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_music_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves a music title given an ID</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The music id to get the title for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com/music/-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
        <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">music_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">][</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">music_object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;Song of </span><span class="si">{}</span><span class="s2"> id does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">music_object</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_secuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the secUid for a specific username</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username to get the secUid for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://tiktok.com/@</span><span class="si">{}</span><span class="s2">?lang=en&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/@</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;secUid&quot;:&quot;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;,&quot;secret&quot;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Retrieving the user secUid failed. Likely due to TikTok wanting captcha validation. Try to use a proxy.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_device_id</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Generates a valid device_id for other methods. Pass this as the custom_device_id field to download videos&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)])</span>

    <span class="c1">#</span>
    <span class="c1"># PRIVATE METHODS</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">__format_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the proxy object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span>
        <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__get_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://sf16-muse-va.ibytedtos.com/obj/rc-web-sdk-gcs/acrawler.js&quot;</span><span class="p">,</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">__format_new_params__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># TODO: Maybe try not doing this? It should be handled by the urlencode.</span>
        <span class="k">return</span> <span class="n">parm</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%2F</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;%3B&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add_url_params__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aid&quot;</span><span class="p">:</span> <span class="mi">1988</span><span class="p">,</span>
            <span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;tiktok_web&quot;</span><span class="p">,</span>
            <span class="s2">&quot;device_platform&quot;</span><span class="p">:</span> <span class="s2">&quot;web_mobile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="ow">or</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span>
            <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;ios&quot;</span><span class="p">,</span>
            <span class="s2">&quot;referer&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;root_referer&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cookie_enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;screen_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="s2">&quot;screen_height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;browser_language&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;en-us&quot;</span><span class="p">,</span>
            <span class="s2">&quot;browser_platform&quot;</span><span class="p">:</span> <span class="s2">&quot;iPhone&quot;</span><span class="p">,</span>
            <span class="s2">&quot;browser_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla&quot;</span><span class="p">,</span>
            <span class="s2">&quot;browser_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span><span class="p">),</span>
            <span class="s2">&quot;browser_online&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timezone_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="ow">or</span> <span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_page_visible&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;focus_state&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_fullscreen&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;history_len&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="ow">or</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__extract_tag_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">):</span>
        <span class="n">nonce_start</span> <span class="o">=</span> <span class="s1">&#39;&lt;head nonce=&quot;&#39;</span>
        <span class="n">nonce_end</span> <span class="o">=</span> <span class="s1">&#39;&quot;&gt;&#39;</span>
        <span class="n">nonce</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">nonce_start</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">nonce_end</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">j_raw</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="s1">&#39;&lt;script id=&quot;__NEXT_DATA__&quot; type=&quot;application/json&quot; nonce=&quot;</span><span class="si">%s</span><span class="s1">&quot; crossorigin=&quot;anonymous&quot;&gt;&#39;</span>
            <span class="o">%</span> <span class="n">nonce</span>
        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/script&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">j_raw</span>

    <span class="c1"># Process the kwargs</span>
    <span class="k">def</span> <span class="nf">__process_kwargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">)</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">maxCount</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxCount&quot;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">device_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">device_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">region</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">maxCount</span><span class="p">,</span> <span class="n">device_id</span>
</pre></div>

        </details>

            </section>
                <section id="TikTokApi">
                                <div class="attr class">
        <a class="headerlink" href="#TikTokApi">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">TikTokApi</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TikTokApi</span><span class="p">:</span>
    <span class="n">__instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The TikTokApi class. Used to interact with TikTok, use get_instance NOT this.&quot;&quot;&quot;</span>
        <span class="c1"># Forces Singleton</span>
        <span class="k">if</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only one TikTokApi object is allowed&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logging_level&quot;</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Class initalized&quot;</span><span class="p">)</span>

        <span class="c1"># Some Instance Vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executablePath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executablePath&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_did&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please use custom_device_id instead of custom_device_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) &quot;</span>
            <span class="s2">&quot;AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span>
            <span class="s2">&quot;Chrome/86.0.4240.111 Safari/537.36&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;external_signer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request_delay&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;requests_extra_kwargs&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_test_endpoints&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">BASE_URL</span>
            <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://t.tiktok.com/&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_selenium&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.browser_utilities.browser_selenium</span> <span class="kn">import</span> <span class="n">browser</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.browser_utilities.browser</span> <span class="kn">import</span> <span class="n">browser</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;generate_static_device_id&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">browser</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">timezone_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">browser_language</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">height</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">region</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">language</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;An error ocurred while opening your browser but it was ignored.&quot;</span>
            <span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Are you sure you ran python -m playwright install&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;1920&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="s2">&quot;1080&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;US&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The TikTokApi class. Used to interact with TikTok. This is a singleton</span>
<span class="sd">            class to prevent issues from arising with playwright</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * logging_level: The logging level you want the program to run at, optional</span>
<span class="sd">            These are the standard python logging module&#39;s levels.</span>

<span class="sd">        * request_delay: The amount of time in seconds to wait before making a request, optional</span>
<span class="sd">            This is used to throttle your own requests as you may end up making too</span>
<span class="sd">            many requests to TikTok for your IP.</span>

<span class="sd">        * custom_device_id: A TikTok parameter needed to download videos, optional</span>
<span class="sd">            The code generates these and handles these pretty well itself, however</span>
<span class="sd">            for some things such as video download you will need to set a consistent</span>
<span class="sd">            one of these. All the methods take this as a optional parameter, however</span>
<span class="sd">            it&#39;s cleaner code to store this at the instance level. You can override</span>
<span class="sd">            this at the specific methods.</span>

<span class="sd">        * generate_static_device_id: A parameter that generates a custom_device_id at the instance level</span>
<span class="sd">            Use this if you want to download videos from a script but don&#39;t want to generate</span>
<span class="sd">            your own custom_device_id parameter.</span>

<span class="sd">        * custom_verifyFp: A TikTok parameter needed to work most of the time, optional</span>
<span class="sd">            To get this parameter look at [this video](https://youtu.be/zwLmLfVI-VQ?t=117)</span>
<span class="sd">            I recommend watching the entire thing, as it will help setup this package. All</span>
<span class="sd">            the methods take this as a optional parameter, however it&#39;s cleaner code</span>
<span class="sd">            to store this at the instance level. You can override this at the specific</span>
<span class="sd">            methods.</span>

<span class="sd">            You can use the following to generate `&quot;&quot;.join(random.choice(string.digits)</span>
<span class="sd">            for num in range(19))`</span>

<span class="sd">        * use_test_endpoints: Send requests to TikTok&#39;s test endpoints, optional</span>
<span class="sd">            This parameter when set to true will make requests to TikTok&#39;s testing</span>
<span class="sd">            endpoints instead of the live site. I can&#39;t guarantee this will work</span>
<span class="sd">            in the future, however currently basically any custom_verifyFp will</span>
<span class="sd">            work here which is helpful.</span>

<span class="sd">        * proxy: A string containing your proxy address, optional</span>
<span class="sd">            If you want to do a lot of scraping of TikTok endpoints you&#39;ll likely</span>
<span class="sd">            need a proxy.</span>

<span class="sd">            Ex: &quot;https://0.0.0.0:8080&quot;</span>

<span class="sd">            All the methods take this as a optional parameter, however it&#39;s cleaner code</span>
<span class="sd">            to store this at the instance level. You can override this at the specific</span>
<span class="sd">            methods.</span>

<span class="sd">        * use_selenium: Option to use selenium over playwright, optional</span>
<span class="sd">            Playwright is selected by default and is the one that I&#39;m designing the</span>
<span class="sd">            package to be compatable for, however if playwright doesn&#39;t work on</span>
<span class="sd">            your machine feel free to set this to True.</span>

<span class="sd">        * executablePath: The location of the driver, optional</span>
<span class="sd">            This shouldn&#39;t be needed if you&#39;re using playwright</span>

<span class="sd">        * **kwargs</span>
<span class="sd">            Parameters that are passed on to basically every module and methods</span>
<span class="sd">            that interact with this main class. These may or may not be documented</span>
<span class="sd">            in other places.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span><span class="p">:</span>
            <span class="n">TikTokApi</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span>

    <span class="k">def</span> <span class="nf">clean_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A basic cleanup method, called automatically from the code&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A basic cleanup method, called automatically from the code&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">clean_up</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">get_playwright</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">external_signer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">custom_device_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verifyFp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes requests to an external signer instead of using a browser.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The server to make requests to</span>
<span class="sd">            This server is designed to sign requests. You can find an example</span>
<span class="sd">            of this signature server in the examples folder.</span>

<span class="sd">        * custom_device_id: A TikTok parameter needed to download videos</span>
<span class="sd">            The code generates these and handles these pretty well itself, however</span>
<span class="sd">            for some things such as video download you will need to set a consistent</span>
<span class="sd">            one of these.</span>

<span class="sd">        * custom_verifyFp: A TikTok parameter needed to work most of the time,</span>
<span class="sd">            To get this parameter look at [this video](https://youtu.be/zwLmLfVI-VQ?t=117)</span>
<span class="sd">            I recommend watching the entire thing, as it will help setup this package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">custom_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;custom_device_id&quot;</span><span class="p">:</span> <span class="n">custom_device_id</span><span class="p">,</span>
                <span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="o">+</span> <span class="s2">&quot;?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;_signature&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;userAgent&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;referrer&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Makes requests to TikTok and returns their JSON.</span>

<span class="sd">        This is all handled by the package so it&#39;s unlikely</span>
<span class="sd">        you will need to use this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="s2">&quot;verify_khr3jabg_V7ucdslq_Vrw9_4KPb_AJ1b_Ks706M8zIJTq&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>

        <span class="n">tt_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">send_tt_params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;send_tt_params&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verifyFp</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">tt_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">sign_url</span><span class="p">(</span>
                <span class="n">calc_tt_params</span><span class="o">=</span><span class="n">send_tt_params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>
            <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">referrer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">userAgent</span><span class="p">,</span> <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_signer</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
                <span class="n">custom_device_id</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">),</span>
                <span class="n">verifyFp</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">,</span> <span class="n">verifyFp</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;send_tt_params&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">tt_params</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verify_fp</span><span class="p">,</span> <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span> <span class="s2">&quot;_signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x-secsdk-csrf-version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;x-secsdk-csrf-request&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">csrf_session_id</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">]</span>
        <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Ware-Csrf-Token&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csrf_session_id</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;authority&quot;</span><span class="p">:</span> <span class="s2">&quot;m.tiktok.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;tiktok.com&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json, text/plain, */*&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate, br&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept-language&quot;</span><span class="p">:</span> <span class="s2">&quot;en-US,en;q=0.9&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="n">referrer</span><span class="p">,</span>
            <span class="s2">&quot;referer&quot;</span><span class="p">:</span> <span class="n">referrer</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-dest&quot;</span><span class="p">:</span> <span class="s2">&quot;empty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-mode&quot;</span><span class="p">:</span> <span class="s2">&quot;cors&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-site&quot;</span><span class="p">:</span> <span class="s2">&quot;same-site&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-gpc&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user-agent&quot;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
            <span class="s2">&quot;x-secsdk-csrf-token&quot;</span><span class="p">:</span> <span class="n">csrf_token</span><span class="p">,</span>
            <span class="s2">&quot;x-tt-params&quot;</span><span class="p">:</span> <span class="n">tt_params</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GET: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">headers: </span><span class="si">{</span><span class="n">headers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;verify&quot;</span>
                <span class="ow">or</span> <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verifyConfig&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;verify&quot;</span>
            <span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Tiktok wants to display a catcha. Response is:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>
            
            <span class="c1"># statusCode from props-&gt;pageProps-&gt;statusCode thanks @adiantek on #403</span>
            <span class="n">error_codes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;450&quot;</span><span class="p">:</span> <span class="s2">&quot;CLIENT_PAGE_ERROR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10000&quot;</span><span class="p">:</span> <span class="s2">&quot;VERIFY_CODE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10101&quot;</span><span class="p">:</span> <span class="s2">&quot;SERVER_ERROR_NOT_500&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10102&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_NOT_LOGIN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10111&quot;</span><span class="p">:</span> <span class="s2">&quot;NET_ERROR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10113&quot;</span><span class="p">:</span> <span class="s2">&quot;SHARK_SLIDE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10114&quot;</span><span class="p">:</span> <span class="s2">&quot;SHARK_BLOCK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10119&quot;</span><span class="p">:</span> <span class="s2">&quot;LIVE_NEED_LOGIN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10202&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10203&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10204&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10205&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10208&quot;</span><span class="p">:</span> <span class="s2">&quot;EFFECT_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10209&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_BLACK_LIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10210&quot;</span><span class="p">:</span> <span class="s2">&quot;LIVE_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10211&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_SENSITIVITY_WORD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10212&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10213&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_LOW_AGE_M&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10214&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_LOW_AGE_T&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10215&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_ABNORMAL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10216&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_PRIVATE_BY_USER&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10217&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_FIRST_REVIEW_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10218&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10219&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_NO_COPYRIGHT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10220&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_UNSHELVE_BY_MUSIC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10221&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_BAN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10222&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_PRIVATE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10223&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_FTC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10224&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10225&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_UNIQUE_SENSITIVITY&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10227&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_NEED_RECHECK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10228&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_RISK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10229&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_R_MASK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10230&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_RISK_MASK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10231&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_GEOFENCE_BLOCK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10404&quot;</span><span class="p">:</span> <span class="s2">&quot;FYP_VIDEO_LIST_LIMIT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;undefined&quot;</span><span class="p">:</span> <span class="s2">&quot;MEDIA_ERROR&quot;</span>
            <span class="p">}</span>
            <span class="n">statusCode</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;statusCode&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TikTok Returned: </span><span class="si">{</span><span class="n">json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">statusCode</span> <span class="o">==</span> <span class="mi">10201</span><span class="p">:</span>
                <span class="c1"># Invalid Entity</span>
                <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span>
                    <span class="s2">&quot;TikTok returned a response indicating the entity is invalid&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">statusCode</span> <span class="o">==</span> <span class="mi">10219</span><span class="p">:</span>
                <span class="c1"># not available in this region</span>
                <span class="k">raise</span> <span class="n">TikTokNotAvailableError</span><span class="p">(</span><span class="s2">&quot;Content not available for this region&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statusCode</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">statusCode</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GenericTikTokError</span><span class="p">(</span><span class="n">error_codes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">statusCode</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TikTok sent an unknown StatusCode of </span><span class="si">{</span><span class="n">statusCode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response: &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">EmptyResponseError</span><span class="p">(</span>
                    <span class="s2">&quot;Empty response from Tiktok to &quot;</span> <span class="o">+</span> <span class="n">url</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Converting response to JSON failed&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">JSONDecodeFailure</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">def</span> <span class="nf">get_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extracts cookies from the kwargs passed to the function for get_data&quot;&quot;&quot;</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="s2">&quot;verify_khr3jabg_V7ucdslq_Vrw9_4KPb_AJ1b_Ks706M8zIJTq&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_verify_fp_on_cookie_header&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;tt_webid&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;tt_webid_v2&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;csrf_session_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;tt_csrf_token&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;s_v_web_id&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">,</span>
                <span class="s2">&quot;ttwid&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ttwid&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;tt_webid&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;tt_webid_v2&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;csrf_session_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;tt_csrf_token&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;ttwid&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ttwid&quot;</span><span class="p">)</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns TikTok&#39;s response as bytes, similar to get_data&quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">sign_url</span><span class="p">(</span>
                <span class="n">calc_tt_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>
            <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">referrer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">userAgent</span><span class="p">,</span> <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_signer</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">custom_device_id</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verify_fp</span><span class="p">,</span> <span class="s2">&quot;_signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;*/*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;identity;q=1, *;q=0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Language&quot;</span><span class="p">:</span> <span class="s2">&quot;en-US;en;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Cache-Control&quot;</span><span class="p">:</span> <span class="s2">&quot;no-cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;Pragma&quot;</span><span class="p">:</span> <span class="s2">&quot;no-cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Range&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes=0-&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Referer&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.tiktok.com/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">by_trending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets trending TikToks</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * count: The amount of TikToks you want returned, optional</span>

<span class="sd">            Note: TikTok seems to only support at MOST ~2000 TikToks</span>
<span class="sd">            from a single endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        
        <span class="n">spawn</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com&quot;</span><span class="p">,</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span>
        <span class="p">)</span>
        <span class="n">ttwid</span> <span class="o">=</span> <span class="n">spawn</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s2">&quot;ttwid&quot;</span><span class="p">]</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s2">&quot;itemID&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;insertedItemID&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/recommend/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">ttwid</span><span class="o">=</span><span class="n">ttwid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">search_for_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of users that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for users by</span>
<span class="sd">            This string is the term you want to search for users by.</span>

<span class="sd">        * count: The number of users to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span><span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_for_music</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of music that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for music by</span>
<span class="sd">            This string is the term you want to search for music by.</span>

<span class="sd">        * count: The number of music to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span><span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;music&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_for_hashtags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of hashtags that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for music by</span>
<span class="sd">            This string is the term you want to search for music by.</span>

<span class="sd">        * count: The number of music to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span>
            <span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;challenge&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">discover_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of whatever the prefix type you pass in</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search by</span>

<span class="sd">        * prefix: The prefix of what to search for</span>

<span class="sd">        * count: The number search results to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;discoverType&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;needItemList&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;keyWord&quot;</span><span class="p">:</span> <span class="n">search_term</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;useRecommend&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/discover/</span><span class="si">{}</span><span class="s2">/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;userInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;userInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;musicInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;musicInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;challengeInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;challengeInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok is not sending videos beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">offset</span> <span class="o">+=</span> <span class="n">maxCount</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">user_posts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns an array of dictionaries representing TikToks for a user.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">userID</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="n">secUID</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/post/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;itemList&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks given a user&#39;s username.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the TikTok user to get TikToks from</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_posts</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">user_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing of one page of TikToks given a user&#39;s ID and secUID</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * page_size: The number of posts to return per page</span>

<span class="sd">            Gets a specific page of a user, doesn&#39;t iterate.</span>
<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">api_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">BASE_URL</span> <span class="o">+</span> <span class="s2">&quot;api/post/item_list/?</span><span class="si">{}</span><span class="s2">&amp;count=</span><span class="si">{}</span><span class="s2">&amp;id=</span><span class="si">{}</span><span class="s2">&amp;type=1&amp;secUid=</span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&amp;cursor=</span><span class="si">{}</span><span class="s2">&amp;sourceType=8&amp;appId=1233&amp;region=</span><span class="si">{}</span><span class="s2">&amp;language=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span>
                <span class="n">page_size</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">userID</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">secUID</span><span class="p">),</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">region</span><span class="p">,</span>
                <span class="n">language</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_user_pager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a generator to page through a user&#39;s feed</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>

<span class="sd">        * page_size: The number of posts to return in a page</span>

<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_page</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
                <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;itemList&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># No mo results</span>
                <span class="k">return</span>

            <span class="n">cursor</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="k">yield</span> <span class="n">page</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;hasMore&quot;</span><span class="p">]:</span>
                <span class="k">return</span>  <span class="c1"># all done</span>

    <span class="k">def</span> <span class="nf">user_liked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks that a given a user has liked.</span>
<span class="sd">            Note: The user&#39;s likes must be public</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">userID</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="n">secUID</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/favorite/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="s2">&quot;itemList&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User&#39;s likes are most likely private&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">user_liked_by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks a user has liked by username.</span>
<span class="sd">            Note: The user&#39;s likes must be public</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_liked</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">by_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks with a specific sound.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to search by</span>

<span class="sd">            Note: Can be found in the URL of the sound specific page or with other methods.</span>
<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;musicID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">realCount</span><span class="p">),</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;shareUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/music/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">by_sound_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a page of tiktoks with a specific sound.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id: The sound id to search by</span>
<span class="sd">            Note: Can be found in the URL of the sound specific page or with other methods.</span>
<span class="sd">        cursor: offset for pagination</span>
<span class="sd">        page_size: The number of posts to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;musicID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">page_size</span><span class="p">),</span>
            <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/music/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_music_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_music_object_full</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="s2">&quot;music&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_music_object_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com/music/-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">][</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_music_object_full_by_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id, but using the API rather than HTML requests.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">node/share/music/-</span><span class="si">{}</span><span class="s2">?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;statusCode&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10203</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">by_hashtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashtag</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks with a specific hashtag.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * hashtag: The hashtag to search by</span>

<span class="sd">            Without the # symbol</span>

<span class="sd">            A valid string is &quot;funny&quot;</span>
<span class="sd">        * count: The number of posts to return</span>
<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hashtag_object</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)[</span><span class="s2">&quot;challengeInfo&quot;</span><span class="p">][</span><span class="s2">&quot;challenge&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">required_count</span> <span class="o">=</span> <span class="n">count</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">required_count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">maxCount</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;challengeID&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/challenge/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">offset</span> <span class="o">+=</span> <span class="n">maxCount</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">required_count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_hashtag_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashtag</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a hashtag object.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * hashtag: The hashtag to search by</span>

<span class="sd">            Without the # symbol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">hashtag</span><span class="p">,</span> <span class="s2">&quot;isName&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">node/share/tag/</span><span class="si">{}</span><span class="s2">?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="n">quote</span><span class="p">(</span><span class="n">hashtag</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;challengeInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;challenge&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;Challenge </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hashtag</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_recommended_tiktoks_by_video_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing reccomended TikToks for a specific TikTok video.</span>


<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The id of the video to get suggestions for</span>

<span class="sd">            Can be found using other methods</span>
<span class="sd">        * count: The count of results you want to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/recommend/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_tiktok_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of a specific TikTok.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The id of the TikTok you want to get the object for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;itemId&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/item/detail/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_tiktok_by_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of a TikTok object by url.</span>


<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The TikTok url you want to retrieve</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">url</span>

        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">custom_device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">and</span> <span class="s2">&quot;/video/&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">post_id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/video/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;URL format not supported. Below is an example of a supported url.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;https://www.tiktok.com/@therock/video/6829267836783971589&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tiktok_by_id</span><span class="p">(</span>
            <span class="n">post_id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_tiktok_by_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This method retrieves a TikTok using the html</span>
<span class="sd">        endpoints rather than the API based ones.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The url of the TikTok to get</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;tiktok.com&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response is empty&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response: </span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;serverCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;TikTok with that url doesn&#39;t exist&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_user_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets a user object (dictionary)</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="s2">&quot;userInfo&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the full exposed user object</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://tiktok.com/@</span><span class="si">{}</span><span class="s2">?lang=en&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/@</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Tiktok response is empty&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Tiktok response: </span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>

        <span class="n">user</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;serverCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span>
                <span class="s2">&quot;TikTok user with username </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">user</span>

    <span class="k">def</span> <span class="nf">get_video_by_tiktok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads video from TikTok using a TikTok object.</span>

<span class="sd">        You will need to set a custom_device_id to do this for anything but trending.</span>
<span class="sd">        To do this, this is pretty simple you can either generate one yourself or,</span>
<span class="sd">        you can pass the generate_static_device_id=True into the constructor of the</span>
<span class="sd">        TikTokApi class.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * data: A TikTok object</span>

<span class="sd">            A TikTok JSON object from any other method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;downloadAddr&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;itemInfos&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;urls&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;itemInfo&quot;</span><span class="p">][</span><span class="s2">&quot;itemStruct&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;playAddr&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_video_by_download_url</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_video_by_download_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads video from TikTok using download url in a TikTok object</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * download_url: The download url key value in a TikTok object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_video_by_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads a TikTok video by a URL</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * video_url: The TikTok url to download the video from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">tiktok_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tiktok_by_url</span><span class="p">(</span><span class="n">video_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">download_url</span> <span class="o">=</span> <span class="n">tiktok_schema</span><span class="p">[</span><span class="s2">&quot;itemInfo&quot;</span><span class="p">][</span><span class="s2">&quot;itemStruct&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;downloadAddr&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_video_no_watermark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_url</span><span class="p">,</span> <span class="n">return_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the video with no watermark</span>
<span class="sd">        .. deprecated::</span>

<span class="sd">        Deprecated due to TikTok fixing this</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * video_url: The url of the video you want to download</span>

<span class="sd">        * return_bytes: Set this to 0 if you want url, 1 if you want bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Deprecated method, TikTok fixed this.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_music_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves a music title given an ID</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The music id to get the title for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com/music/-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
        <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">music_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">][</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">music_object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;Song of </span><span class="si">{}</span><span class="s2"> id does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">music_object</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_secuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the secUid for a specific username</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username to get the secUid for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://tiktok.com/@</span><span class="si">{}</span><span class="s2">?lang=en&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/@</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;secUid&quot;:&quot;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;,&quot;secret&quot;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Retrieving the user secUid failed. Likely due to TikTok wanting captcha validation. Try to use a proxy.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_device_id</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Generates a valid device_id for other methods. Pass this as the custom_device_id field to download videos&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)])</span>

    <span class="c1">#</span>
    <span class="c1"># PRIVATE METHODS</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">__format_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the proxy object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span>
        <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__get_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://sf16-muse-va.ibytedtos.com/obj/rc-web-sdk-gcs/acrawler.js&quot;</span><span class="p">,</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">__format_new_params__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># TODO: Maybe try not doing this? It should be handled by the urlencode.</span>
        <span class="k">return</span> <span class="n">parm</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%2F</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;%3B&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add_url_params__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aid&quot;</span><span class="p">:</span> <span class="mi">1988</span><span class="p">,</span>
            <span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;tiktok_web&quot;</span><span class="p">,</span>
            <span class="s2">&quot;device_platform&quot;</span><span class="p">:</span> <span class="s2">&quot;web_mobile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="ow">or</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span>
            <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;ios&quot;</span><span class="p">,</span>
            <span class="s2">&quot;referer&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;root_referer&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cookie_enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;screen_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="s2">&quot;screen_height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;browser_language&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;en-us&quot;</span><span class="p">,</span>
            <span class="s2">&quot;browser_platform&quot;</span><span class="p">:</span> <span class="s2">&quot;iPhone&quot;</span><span class="p">,</span>
            <span class="s2">&quot;browser_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla&quot;</span><span class="p">,</span>
            <span class="s2">&quot;browser_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span><span class="p">),</span>
            <span class="s2">&quot;browser_online&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timezone_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="ow">or</span> <span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_page_visible&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;focus_state&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_fullscreen&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;history_len&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="ow">or</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__extract_tag_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">):</span>
        <span class="n">nonce_start</span> <span class="o">=</span> <span class="s1">&#39;&lt;head nonce=&quot;&#39;</span>
        <span class="n">nonce_end</span> <span class="o">=</span> <span class="s1">&#39;&quot;&gt;&#39;</span>
        <span class="n">nonce</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">nonce_start</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">nonce_end</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">j_raw</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="s1">&#39;&lt;script id=&quot;__NEXT_DATA__&quot; type=&quot;application/json&quot; nonce=&quot;</span><span class="si">%s</span><span class="s1">&quot; crossorigin=&quot;anonymous&quot;&gt;&#39;</span>
            <span class="o">%</span> <span class="n">nonce</span>
        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/script&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">j_raw</span>

    <span class="c1"># Process the kwargs</span>
    <span class="k">def</span> <span class="nf">__process_kwargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">)</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">maxCount</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxCount&quot;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">device_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">device_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">region</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">maxCount</span><span class="p">,</span> <span class="n">device_id</span>
</pre></div>

        </details>

    

                            <div id="TikTokApi.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">TikTokApi</span><span class="signature">(**kwargs)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The TikTokApi class. Used to interact with TikTok, use get_instance NOT this.&quot;&quot;&quot;</span>
        <span class="c1"># Forces Singleton</span>
        <span class="k">if</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only one TikTokApi object is allowed&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logging_level&quot;</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Class initalized&quot;</span><span class="p">)</span>

        <span class="c1"># Some Instance Vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executablePath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executablePath&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_did&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please use custom_device_id instead of custom_device_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) &quot;</span>
            <span class="s2">&quot;AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span>
            <span class="s2">&quot;Chrome/86.0.4240.111 Safari/537.36&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;external_signer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request_delay&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;requests_extra_kwargs&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_test_endpoints&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">BASE_URL</span>
            <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://t.tiktok.com/&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_selenium&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.browser_utilities.browser_selenium</span> <span class="kn">import</span> <span class="n">browser</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.browser_utilities.browser</span> <span class="kn">import</span> <span class="n">browser</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;generate_static_device_id&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_device_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">browser</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">timezone_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_new_params__</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">browser_language</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">height</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">region</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">language</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;An error ocurred while opening your browser but it was ignored.&quot;</span>
            <span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Are you sure you ran python -m playwright install&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">timezone_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browser_language</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;1920&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="s2">&quot;1080&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;US&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>The TikTokApi class. Used to interact with TikTok, use get_instance NOT this.</p>
</div>


                            </div>
                            <div id="TikTokApi.get_instance" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_instance">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">get_instance</span><span class="signature">(**kwargs)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The TikTokApi class. Used to interact with TikTok. This is a singleton</span>
<span class="sd">            class to prevent issues from arising with playwright</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * logging_level: The logging level you want the program to run at, optional</span>
<span class="sd">            These are the standard python logging module&#39;s levels.</span>

<span class="sd">        * request_delay: The amount of time in seconds to wait before making a request, optional</span>
<span class="sd">            This is used to throttle your own requests as you may end up making too</span>
<span class="sd">            many requests to TikTok for your IP.</span>

<span class="sd">        * custom_device_id: A TikTok parameter needed to download videos, optional</span>
<span class="sd">            The code generates these and handles these pretty well itself, however</span>
<span class="sd">            for some things such as video download you will need to set a consistent</span>
<span class="sd">            one of these. All the methods take this as a optional parameter, however</span>
<span class="sd">            it&#39;s cleaner code to store this at the instance level. You can override</span>
<span class="sd">            this at the specific methods.</span>

<span class="sd">        * generate_static_device_id: A parameter that generates a custom_device_id at the instance level</span>
<span class="sd">            Use this if you want to download videos from a script but don&#39;t want to generate</span>
<span class="sd">            your own custom_device_id parameter.</span>

<span class="sd">        * custom_verifyFp: A TikTok parameter needed to work most of the time, optional</span>
<span class="sd">            To get this parameter look at [this video](https://youtu.be/zwLmLfVI-VQ?t=117)</span>
<span class="sd">            I recommend watching the entire thing, as it will help setup this package. All</span>
<span class="sd">            the methods take this as a optional parameter, however it&#39;s cleaner code</span>
<span class="sd">            to store this at the instance level. You can override this at the specific</span>
<span class="sd">            methods.</span>

<span class="sd">            You can use the following to generate `&quot;&quot;.join(random.choice(string.digits)</span>
<span class="sd">            for num in range(19))`</span>

<span class="sd">        * use_test_endpoints: Send requests to TikTok&#39;s test endpoints, optional</span>
<span class="sd">            This parameter when set to true will make requests to TikTok&#39;s testing</span>
<span class="sd">            endpoints instead of the live site. I can&#39;t guarantee this will work</span>
<span class="sd">            in the future, however currently basically any custom_verifyFp will</span>
<span class="sd">            work here which is helpful.</span>

<span class="sd">        * proxy: A string containing your proxy address, optional</span>
<span class="sd">            If you want to do a lot of scraping of TikTok endpoints you&#39;ll likely</span>
<span class="sd">            need a proxy.</span>

<span class="sd">            Ex: &quot;https://0.0.0.0:8080&quot;</span>

<span class="sd">            All the methods take this as a optional parameter, however it&#39;s cleaner code</span>
<span class="sd">            to store this at the instance level. You can override this at the specific</span>
<span class="sd">            methods.</span>

<span class="sd">        * use_selenium: Option to use selenium over playwright, optional</span>
<span class="sd">            Playwright is selected by default and is the one that I&#39;m designing the</span>
<span class="sd">            package to be compatable for, however if playwright doesn&#39;t work on</span>
<span class="sd">            your machine feel free to set this to True.</span>

<span class="sd">        * executablePath: The location of the driver, optional</span>
<span class="sd">            This shouldn&#39;t be needed if you&#39;re using playwright</span>

<span class="sd">        * **kwargs</span>
<span class="sd">            Parameters that are passed on to basically every module and methods</span>
<span class="sd">            that interact with this main class. These may or may not be documented</span>
<span class="sd">            in other places.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span><span class="p">:</span>
            <span class="n">TikTokApi</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TikTokApi</span><span class="o">.</span><span class="n">__instance</span>
</pre></div>

        </details>

            <div class="docstring"><p>The TikTokApi class. Used to interact with TikTok. This is a singleton
    class to prevent issues from arising with playwright</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>logging_level: The logging level you want the program to run at, optional
These are the standard python logging module's levels.</p></li>
<li><p>request_delay: The amount of time in seconds to wait before making a request, optional
This is used to throttle your own requests as you may end up making too
many requests to TikTok for your IP.</p></li>
<li><p>custom_device_id: A TikTok parameter needed to download videos, optional
The code generates these and handles these pretty well itself, however
for some things such as video download you will need to set a consistent
one of these. All the methods take this as a optional parameter, however
it's cleaner code to store this at the instance level. You can override
this at the specific methods.</p></li>
<li><p>generate_static_device_id: A parameter that generates a custom_device_id at the instance level
Use this if you want to download videos from a script but don't want to generate
your own custom_device_id parameter.</p></li>
<li><p>custom_verifyFp: A TikTok parameter needed to work most of the time, optional
To get this parameter look at <a href="https://youtu.be/zwLmLfVI-VQ?t=117">this video</a>
I recommend watching the entire thing, as it will help setup this package. All
the methods take this as a optional parameter, however it's cleaner code
to store this at the instance level. You can override this at the specific
methods.</p>

<p>You can use the following to generate <code>"".join(random.choice(string.digits)
for num in range(19))</code></p></li>
<li><p>use_test_endpoints: Send requests to TikTok's test endpoints, optional
This parameter when set to true will make requests to TikTok's testing
endpoints instead of the live site. I can't guarantee this will work
in the future, however currently basically any custom_verifyFp will
work here which is helpful.</p></li>
<li><p>proxy: A string containing your proxy address, optional
If you want to do a lot of scraping of TikTok endpoints you'll likely
need a proxy.</p>

<p>Ex: "https://0.0.0.0:8080"</p>

<p>All the methods take this as a optional parameter, however it's cleaner code
to store this at the instance level. You can override this at the specific
methods.</p></li>
<li><p>use_selenium: Option to use selenium over playwright, optional
Playwright is selected by default and is the one that I'm designing the
package to be compatable for, however if playwright doesn't work on
your machine feel free to set this to True.</p></li>
<li><p>executablePath: The location of the driver, optional
This shouldn't be needed if you're using playwright</p></li>
<li><p>**kwargs
Parameters that are passed on to basically every module and methods
that interact with this main class. These may or may not be documented
in other places.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.clean_up" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.clean_up">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">clean_up</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">clean_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A basic cleanup method, called automatically from the code&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>A basic cleanup method, called automatically from the code</p>
</div>


                            </div>
                            <div id="TikTokApi.external_signer" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.external_signer">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">external_signer</span><span class="signature">(self, url, custom_device_id=None, verifyFp=None)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">external_signer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">custom_device_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verifyFp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes requests to an external signer instead of using a browser.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The server to make requests to</span>
<span class="sd">            This server is designed to sign requests. You can find an example</span>
<span class="sd">            of this signature server in the examples folder.</span>

<span class="sd">        * custom_device_id: A TikTok parameter needed to download videos</span>
<span class="sd">            The code generates these and handles these pretty well itself, however</span>
<span class="sd">            for some things such as video download you will need to set a consistent</span>
<span class="sd">            one of these.</span>

<span class="sd">        * custom_verifyFp: A TikTok parameter needed to work most of the time,</span>
<span class="sd">            To get this parameter look at [this video](https://youtu.be/zwLmLfVI-VQ?t=117)</span>
<span class="sd">            I recommend watching the entire thing, as it will help setup this package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">custom_device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;custom_device_id&quot;</span><span class="p">:</span> <span class="n">custom_device_id</span><span class="p">,</span>
                <span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="o">+</span> <span class="s2">&quot;?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;_signature&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;userAgent&quot;</span><span class="p">],</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;referrer&quot;</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Makes requests to an external signer instead of using a browser.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>url: The server to make requests to
This server is designed to sign requests. You can find an example
of this signature server in the examples folder.</p></li>
<li><p>custom_device_id: A TikTok parameter needed to download videos
The code generates these and handles these pretty well itself, however
for some things such as video download you will need to set a consistent
one of these.</p></li>
<li><p>custom_verifyFp: A TikTok parameter needed to work most of the time,
To get this parameter look at <a href="https://youtu.be/zwLmLfVI-VQ?t=117">this video</a>
I recommend watching the entire thing, as it will help setup this package.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_data" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_data">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_data</span><span class="signature">(self, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Makes requests to TikTok and returns their JSON.</span>

<span class="sd">        This is all handled by the package so it&#39;s unlikely</span>
<span class="sd">        you will need to use this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_delay</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="s2">&quot;verify_khr3jabg_V7ucdslq_Vrw9_4KPb_AJ1b_Ks706M8zIJTq&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>

        <span class="n">tt_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">send_tt_params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;send_tt_params&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verifyFp</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">tt_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">sign_url</span><span class="p">(</span>
                <span class="n">calc_tt_params</span><span class="o">=</span><span class="n">send_tt_params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>
            <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">referrer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">userAgent</span><span class="p">,</span> <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_signer</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
                <span class="n">custom_device_id</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">),</span>
                <span class="n">verifyFp</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">,</span> <span class="n">verifyFp</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;send_tt_params&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">tt_params</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verify_fp</span><span class="p">,</span> <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span> <span class="s2">&quot;_signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x-secsdk-csrf-version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.2.5&quot;</span><span class="p">,</span> <span class="s2">&quot;x-secsdk-csrf-request&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">csrf_session_id</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">]</span>
        <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Ware-Csrf-Token&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csrf_session_id</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;authority&quot;</span><span class="p">:</span> <span class="s2">&quot;m.tiktok.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;tiktok.com&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json, text/plain, */*&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate, br&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept-language&quot;</span><span class="p">:</span> <span class="s2">&quot;en-US,en;q=0.9&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="n">referrer</span><span class="p">,</span>
            <span class="s2">&quot;referer&quot;</span><span class="p">:</span> <span class="n">referrer</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-dest&quot;</span><span class="p">:</span> <span class="s2">&quot;empty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-mode&quot;</span><span class="p">:</span> <span class="s2">&quot;cors&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-fetch-site&quot;</span><span class="p">:</span> <span class="s2">&quot;same-site&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec-gpc&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user-agent&quot;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
            <span class="s2">&quot;x-secsdk-csrf-token&quot;</span><span class="p">:</span> <span class="n">csrf_token</span><span class="p">,</span>
            <span class="s2">&quot;x-tt-params&quot;</span><span class="p">:</span> <span class="n">tt_params</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GET: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">headers: </span><span class="si">{</span><span class="n">headers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;verify&quot;</span>
                <span class="ow">or</span> <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verifyConfig&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;verify&quot;</span>
            <span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Tiktok wants to display a catcha. Response is:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>
            
            <span class="c1"># statusCode from props-&gt;pageProps-&gt;statusCode thanks @adiantek on #403</span>
            <span class="n">error_codes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;450&quot;</span><span class="p">:</span> <span class="s2">&quot;CLIENT_PAGE_ERROR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10000&quot;</span><span class="p">:</span> <span class="s2">&quot;VERIFY_CODE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10101&quot;</span><span class="p">:</span> <span class="s2">&quot;SERVER_ERROR_NOT_500&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10102&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_NOT_LOGIN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10111&quot;</span><span class="p">:</span> <span class="s2">&quot;NET_ERROR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10113&quot;</span><span class="p">:</span> <span class="s2">&quot;SHARK_SLIDE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10114&quot;</span><span class="p">:</span> <span class="s2">&quot;SHARK_BLOCK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10119&quot;</span><span class="p">:</span> <span class="s2">&quot;LIVE_NEED_LOGIN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10202&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10203&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10204&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10205&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10208&quot;</span><span class="p">:</span> <span class="s2">&quot;EFFECT_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10209&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_BLACK_LIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10210&quot;</span><span class="p">:</span> <span class="s2">&quot;LIVE_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10211&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_SENSITIVITY_WORD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10212&quot;</span><span class="p">:</span> <span class="s2">&quot;HASHTAG_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10213&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_LOW_AGE_M&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10214&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_LOW_AGE_T&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10215&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_ABNORMAL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10216&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_PRIVATE_BY_USER&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10217&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_FIRST_REVIEW_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10218&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_UNSHELVE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10219&quot;</span><span class="p">:</span> <span class="s2">&quot;MUSIC_NO_COPYRIGHT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10220&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_UNSHELVE_BY_MUSIC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10221&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_BAN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10222&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_PRIVATE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10223&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_FTC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10224&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME_NOT_EXIST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10225&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_UNIQUE_SENSITIVITY&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10227&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_NEED_RECHECK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10228&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_RISK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10229&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_R_MASK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10230&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_RISK_MASK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10231&quot;</span><span class="p">:</span> <span class="s2">&quot;VIDEO_GEOFENCE_BLOCK&quot;</span><span class="p">,</span>
                <span class="s2">&quot;10404&quot;</span><span class="p">:</span> <span class="s2">&quot;FYP_VIDEO_LIST_LIMIT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;undefined&quot;</span><span class="p">:</span> <span class="s2">&quot;MEDIA_ERROR&quot;</span>
            <span class="p">}</span>
            <span class="n">statusCode</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;statusCode&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TikTok Returned: </span><span class="si">{</span><span class="n">json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">statusCode</span> <span class="o">==</span> <span class="mi">10201</span><span class="p">:</span>
                <span class="c1"># Invalid Entity</span>
                <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span>
                    <span class="s2">&quot;TikTok returned a response indicating the entity is invalid&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">statusCode</span> <span class="o">==</span> <span class="mi">10219</span><span class="p">:</span>
                <span class="c1"># not available in this region</span>
                <span class="k">raise</span> <span class="n">TikTokNotAvailableError</span><span class="p">(</span><span class="s2">&quot;Content not available for this region&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statusCode</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">statusCode</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GenericTikTokError</span><span class="p">(</span><span class="n">error_codes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">statusCode</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TikTok sent an unknown StatusCode of </span><span class="si">{</span><span class="n">statusCode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response: &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">EmptyResponseError</span><span class="p">(</span>
                    <span class="s2">&quot;Empty response from Tiktok to &quot;</span> <span class="o">+</span> <span class="n">url</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Converting response to JSON failed&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">JSONDecodeFailure</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">e</span>
</pre></div>

        </details>

            <div class="docstring"><p>Makes requests to TikTok and returns their JSON.</p>

<p>This is all handled by the package so it's unlikely
you will need to use this.</p>
</div>


                            </div>
                            <div id="TikTokApi.get_cookies" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_cookies">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_cookies</span><span class="signature">(self, **kwargs)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extracts cookies from the kwargs passed to the function for get_data&quot;&quot;&quot;</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_verifyFp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verifyFp</span> <span class="o">=</span> <span class="s2">&quot;verify_khr3jabg_V7ucdslq_Vrw9_4KPb_AJ1b_Ks706M8zIJTq&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verifyFp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_verifyFp&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_verify_fp_on_cookie_header&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;tt_webid&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;tt_webid_v2&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;csrf_session_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;tt_csrf_token&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;s_v_web_id&quot;</span><span class="p">:</span> <span class="n">verifyFp</span><span class="p">,</span>
                <span class="s2">&quot;ttwid&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ttwid&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;tt_webid&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;tt_webid_v2&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;csrf_session_id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;csrf_session_id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;tt_csrf_token&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;ttwid&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ttwid&quot;</span><span class="p">)</span>
            <span class="p">}</span>
</pre></div>

        </details>

            <div class="docstring"><p>Extracts cookies from the kwargs passed to the function for get_data</p>
</div>


                            </div>
                            <div id="TikTokApi.get_bytes" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_bytes">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_bytes</span><span class="signature">(self, **kwargs) -&gt; bytes</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns TikTok&#39;s response as bytes, similar to get_data&quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signer_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">sign_url</span><span class="p">(</span>
                <span class="n">calc_tt_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">userAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">userAgent</span>
            <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">referrer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verify_fp</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">userAgent</span><span class="p">,</span> <span class="n">referrer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_signer</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">custom_device_id</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;verifyFp&quot;</span><span class="p">:</span> <span class="n">verify_fp</span><span class="p">,</span> <span class="s2">&quot;_signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;*/*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;identity;q=1, *;q=0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Language&quot;</span><span class="p">:</span> <span class="s2">&quot;en-US;en;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Cache-Control&quot;</span><span class="p">:</span> <span class="s2">&quot;no-cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;Pragma&quot;</span><span class="p">:</span> <span class="s2">&quot;no-cache&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Range&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes=0-&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Referer&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.tiktok.com/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="n">userAgent</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns TikTok's response as bytes, similar to get_data</p>
</div>


                            </div>
                            <div id="TikTokApi.by_trending" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.by_trending">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">by_trending</span><span class="signature">(self, count=30, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">by_trending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets trending TikToks</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * count: The amount of TikToks you want returned, optional</span>

<span class="sd">            Note: TikTok seems to only support at MOST ~2000 TikToks</span>
<span class="sd">            from a single endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        
        <span class="n">spawn</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com&quot;</span><span class="p">,</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span>
        <span class="p">)</span>
        <span class="n">ttwid</span> <span class="o">=</span> <span class="n">spawn</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s2">&quot;ttwid&quot;</span><span class="p">]</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s2">&quot;itemID&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;insertedItemID&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/recommend/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">ttwid</span><span class="o">=</span><span class="n">ttwid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets trending TikToks</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>count: The amount of TikToks you want returned, optional</p>

<p>Note: TikTok seems to only support at MOST ~2000 TikToks
from a single endpoint.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.search_for_users" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.search_for_users">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">search_for_users</span><span class="signature">(self, search_term, count=28, **kwargs) -&gt; list</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">search_for_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of users that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for users by</span>
<span class="sd">            This string is the term you want to search for users by.</span>

<span class="sd">        * count: The number of users to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span><span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a list of users that match the search_term</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>search_term: The string to search for users by
This string is the term you want to search for users by.</p></li>
<li><p>count: The number of users to return
Note: maximum is around 28 for this type of endpoint.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.search_for_music" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.search_for_music">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">search_for_music</span><span class="signature">(self, search_term, count=28, **kwargs) -&gt; list</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">search_for_music</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of music that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for music by</span>
<span class="sd">            This string is the term you want to search for music by.</span>

<span class="sd">        * count: The number of music to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span><span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;music&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a list of music that match the search_term</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>search_term: The string to search for music by
This string is the term you want to search for music by.</p></li>
<li><p>count: The number of music to return
Note: maximum is around 28 for this type of endpoint.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.search_for_hashtags" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.search_for_hashtags">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">search_for_hashtags</span><span class="signature">(self, search_term, count=28, **kwargs) -&gt; list</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">search_for_hashtags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of hashtags that match the search_term</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search for music by</span>
<span class="sd">            This string is the term you want to search for music by.</span>

<span class="sd">        * count: The number of music to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_type</span><span class="p">(</span>
            <span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;challenge&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a list of hashtags that match the search_term</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>search_term: The string to search for music by
This string is the term you want to search for music by.</p></li>
<li><p>count: The number of music to return
Note: maximum is around 28 for this type of endpoint.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.discover_type" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.discover_type">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">discover_type</span><span class="signature">(self, search_term, prefix, count=28, offset=0, **kwargs) -&gt; list</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">discover_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of whatever the prefix type you pass in</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * search_term: The string to search by</span>

<span class="sd">        * prefix: The prefix of what to search for</span>

<span class="sd">        * count: The number search results to return</span>
<span class="sd">            Note: maximum is around 28 for this type of endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;discoverType&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;needItemList&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;keyWord&quot;</span><span class="p">:</span> <span class="n">search_term</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;useRecommend&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/discover/</span><span class="si">{}</span><span class="s2">/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;userInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;userInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;musicInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;musicInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;challengeInfoList&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;challengeInfoList&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok is not sending videos beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">offset</span> <span class="o">+=</span> <span class="n">maxCount</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a list of whatever the prefix type you pass in</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>search_term: The string to search by</p></li>
<li><p>prefix: The prefix of what to search for</p></li>
<li><p>count: The number search results to return
Note: maximum is around 28 for this type of endpoint.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.user_posts" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.user_posts">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">user_posts</span><span class="signature">(self, userID, secUID, count=30, cursor=0, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">user_posts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns an array of dictionaries representing TikToks for a user.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">userID</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="n">secUID</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/post/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;itemList&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns an array of dictionaries representing TikToks for a user.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>userID: The userID of the user, which TikTok assigns</p>

<p>You can find this from utilizing other methods or
just use by_username to find it.</p></li>
<li><p>secUID: The secUID of the user, which TikTok assigns</p>

<p>You can find this from utilizing other methods or
just use by_username to find it.</p></li>
<li><p>count: The number of posts to return</p>

<p>Note: seems to only support up to ~2,000</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.by_username" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.by_username">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">by_username</span><span class="signature">(self, username, count=30, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks given a user&#39;s username.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the TikTok user to get TikToks from</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_posts</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary listing TikToks given a user's username.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>username: The username of the TikTok user to get TikToks from</p></li>
<li><p>count: The number of posts to return</p>

<p>Note: seems to only support up to ~2,000</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.user_page" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.user_page">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">user_page</span><span class="signature">(self, userID, secUID, page_size=30, cursor=0, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">user_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing of one page of TikToks given a user&#39;s ID and secUID</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">            You can find this from utilizing other methods or</span>
<span class="sd">            just use by_username to find it.</span>
<span class="sd">        * page_size: The number of posts to return per page</span>

<span class="sd">            Gets a specific page of a user, doesn&#39;t iterate.</span>
<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">api_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">BASE_URL</span> <span class="o">+</span> <span class="s2">&quot;api/post/item_list/?</span><span class="si">{}</span><span class="s2">&amp;count=</span><span class="si">{}</span><span class="s2">&amp;id=</span><span class="si">{}</span><span class="s2">&amp;type=1&amp;secUid=</span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&amp;cursor=</span><span class="si">{}</span><span class="s2">&amp;sourceType=8&amp;appId=1233&amp;region=</span><span class="si">{}</span><span class="s2">&amp;language=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span>
                <span class="n">page_size</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">userID</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">secUID</span><span class="p">),</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">region</span><span class="p">,</span>
                <span class="n">language</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary listing of one page of TikToks given a user's ID and secUID</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>userID: The userID of the user, which TikTok assigns</p>

<p>You can find this from utilizing other methods or
just use by_username to find it.</p></li>
<li><p>secUID: The secUID of the user, which TikTok assigns</p>

<p>You can find this from utilizing other methods or
just use by_username to find it.</p></li>
<li><p>page_size: The number of posts to return per page</p>

<p>Gets a specific page of a user, doesn't iterate.</p></li>
<li><p>cursor: The offset of a page</p>

<p>The offset to return new videos from</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_user_pager" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_user_pager">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_user_pager</span><span class="signature">(self, username, page_size=30, cursor=0, **kwargs)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_user_pager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a generator to page through a user&#39;s feed</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>

<span class="sd">        * page_size: The number of posts to return in a page</span>

<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_page</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
                <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;itemList&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># No mo results</span>
                <span class="k">return</span>

            <span class="n">cursor</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="k">yield</span> <span class="n">page</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;hasMore&quot;</span><span class="p">]:</span>
                <span class="k">return</span>  <span class="c1"># all done</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a generator to page through a user's feed</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>username: The username of the user</p></li>
<li><p>page_size: The number of posts to return in a page</p></li>
<li><p>cursor: The offset of a page</p>

<p>The offset to return new videos from</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.user_liked" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.user_liked">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">user_liked</span><span class="signature">(self, userID, secUID, count=30, cursor=0, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">user_liked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">secUID</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks that a given a user has liked.</span>
<span class="sd">            Note: The user&#39;s likes must be public</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * userID: The userID of the user, which TikTok assigns</span>

<span class="sd">        * secUID: The secUID of the user, which TikTok assigns</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        * cursor: The offset of a page</span>

<span class="sd">            The offset to return new videos from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">userID</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="n">secUID</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/favorite/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="s2">&quot;itemList&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User&#39;s likes are most likely private&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary listing TikToks that a given a user has liked.
    Note: The user's likes must be public</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>userID: The userID of the user, which TikTok assigns</p></li>
<li><p>secUID: The secUID of the user, which TikTok assigns</p></li>
<li><p>count: The number of posts to return</p>

<p>Note: seems to only support up to ~2,000</p></li>
<li><p>cursor: The offset of a page</p>

<p>The offset to return new videos from</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.user_liked_by_username" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.user_liked_by_username">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">user_liked_by_username</span><span class="signature">(self, username, count=30, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">user_liked_by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks a user has liked by username.</span>
<span class="sd">            Note: The user&#39;s likes must be public</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>

<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_object</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_liked</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secUid&quot;</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary listing TikToks a user has liked by username.
    Note: The user's likes must be public</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>username: The username of the user</p></li>
<li><p>count: The number of posts to return</p>

<p>Note: seems to only support up to ~2,000</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.by_sound" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.by_sound">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">by_sound</span><span class="signature">(self, id, count=30, offset=0, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">by_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks with a specific sound.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to search by</span>

<span class="sd">            Note: Can be found in the URL of the sound specific page or with other methods.</span>
<span class="sd">        * count: The number of posts to return</span>

<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;musicID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">realCount</span><span class="p">),</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;shareUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/music/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary listing TikToks with a specific sound.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>id: The sound id to search by</p>

<p>Note: Can be found in the URL of the sound specific page or with other methods.</p></li>
<li><p>count: The number of posts to return</p>

<p>Note: seems to only support up to ~2,000</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.by_sound_page" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.by_sound_page">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">by_sound_page</span><span class="signature">(self, id, page_size=30, cursor=0, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">by_sound_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a page of tiktoks with a specific sound.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id: The sound id to search by</span>
<span class="sd">            Note: Can be found in the URL of the sound specific page or with other methods.</span>
<span class="sd">        cursor: offset for pagination</span>
<span class="sd">        page_size: The number of posts to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;musicID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">page_size</span><span class="p">),</span>
            <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">cursor</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/music/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">send_tt_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a page of tiktoks with a specific sound.</p>

<h2 id="parameters">Parameters</h2>

<p>id: The sound id to search by
    Note: Can be found in the URL of the sound specific page or with other methods.
cursor: offset for pagination
page_size: The number of posts to return</p>
</div>


                            </div>
                            <div id="TikTokApi.get_music_object" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_music_object">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_music_object</span><span class="signature">(self, id, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_music_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_music_object_full</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="s2">&quot;music&quot;</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a music object for a specific sound id.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>id: The sound id to get the object for</p>

<p>This can be found by using other methods.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_music_object_full" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_music_object_full">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_music_object_full</span><span class="signature">(self, id, **kwargs)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_music_object_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com/music/-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">userAgent</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">][</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a music object for a specific sound id.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>id: The sound id to get the object for</p>

<p>This can be found by using other methods.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_music_object_full_by_api" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_music_object_full_by_api">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_music_object_full_by_api</span><span class="signature">(self, id, **kwargs)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_music_object_full_by_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a music object for a specific sound id, but using the API rather than HTML requests.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The sound id to get the object for</span>

<span class="sd">            This can be found by using other methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">node/share/music/-</span><span class="si">{}</span><span class="s2">?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;statusCode&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10203</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a music object for a specific sound id, but using the API rather than HTML requests.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>id: The sound id to get the object for</p>

<p>This can be found by using other methods.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.by_hashtag" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.by_hashtag">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">by_hashtag</span><span class="signature">(self, hashtag, count=30, offset=0, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">by_hashtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashtag</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing TikToks with a specific hashtag.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * hashtag: The hashtag to search by</span>

<span class="sd">            Without the # symbol</span>

<span class="sd">            A valid string is &quot;funny&quot;</span>
<span class="sd">        * count: The number of posts to return</span>
<span class="sd">            Note: seems to only support up to ~2,000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hashtag_object</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)[</span><span class="s2">&quot;challengeInfo&quot;</span><span class="p">][</span><span class="s2">&quot;challenge&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">required_count</span> <span class="o">=</span> <span class="n">count</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">required_count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">maxCount</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;challengeID&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/challenge/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="n">offset</span> <span class="o">+=</span> <span class="n">maxCount</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">required_count</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary listing TikToks with a specific hashtag.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>hashtag: The hashtag to search by</p>

<p>Without the # symbol</p>

<p>A valid string is "funny"</p></li>
<li>count: The number of posts to return
Note: seems to only support up to ~2,000</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_hashtag_object" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_hashtag_object">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_hashtag_object</span><span class="signature">(self, hashtag, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_hashtag_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashtag</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a hashtag object.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * hashtag: The hashtag to search by</span>

<span class="sd">            Without the # symbol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">hashtag</span><span class="p">,</span> <span class="s2">&quot;isName&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">node/share/tag/</span><span class="si">{}</span><span class="s2">?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="n">quote</span><span class="p">(</span><span class="n">hashtag</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;challengeInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;challenge&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;Challenge </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hashtag</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a hashtag object.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>hashtag: The hashtag to search by</p>

<p>Without the # symbol</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_recommended_tiktoks_by_video_id" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_recommended_tiktoks_by_video_id">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_recommended_tiktoks_by_video_id</span><span class="signature">(self, id, count=30, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_recommended_tiktoks_by_video_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary listing reccomended TikToks for a specific TikTok video.</span>


<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The id of the video to get suggestions for</span>

<span class="sd">            Can be found using other methods</span>
<span class="sd">        * count: The count of results you want to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxCount</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">realCount</span> <span class="o">=</span> <span class="n">maxCount</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">realCount</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;secUid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sourceType&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="mi">1233</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;priority_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/recommend/item_list/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;itemList&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasMore&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;TikTok isn&#39;t sending more TikToks beyond this point.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

            <span class="n">realCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary listing reccomended TikToks for a specific TikTok video.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>id: The id of the video to get suggestions for</p>

<p>Can be found using other methods</p></li>
<li>count: The count of results you want to return</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_tiktok_by_id" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_tiktok_by_id">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_tiktok_by_id</span><span class="signature">(self, id, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_tiktok_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of a specific TikTok.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The id of the TikTok you want to get the object for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;itemId&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">api/item/detail/?</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">BASE_URL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_url_params__</span><span class="p">(),</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary of a specific TikTok.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>id: The id of the TikTok you want to get the object for</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_tiktok_by_url" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_tiktok_by_url">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_tiktok_by_url</span><span class="signature">(self, url, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_tiktok_by_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary of a TikTok object by url.</span>


<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The TikTok url you want to retrieve</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">url</span>

        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="n">custom_device_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">and</span> <span class="s2">&quot;/video/&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">post_id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/video/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;URL format not supported. Below is an example of a supported url.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;https://www.tiktok.com/@therock/video/6829267836783971589&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tiktok_by_id</span><span class="p">(</span>
            <span class="n">post_id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns a dictionary of a TikTok object by url.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>url: The TikTok url you want to retrieve</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_tiktok_by_html" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_tiktok_by_html">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_tiktok_by_html</span><span class="signature">(self, url, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_tiktok_by_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This method retrieves a TikTok using the html</span>
<span class="sd">        endpoints rather than the API based ones.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * url: The url of the TikTok to get</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;tiktok.com&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response is empty&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TikTok response: </span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;serverCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;TikTok with that url doesn&#39;t exist&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>
</pre></div>

        </details>

            <div class="docstring"><p>This method retrieves a TikTok using the html
endpoints rather than the API based ones.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>url: The url of the TikTok to get</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_user_object" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_user_object">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_user_object</span><span class="signature">(self, username, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_user_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets a user object (dictionary)</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="s2">&quot;userInfo&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets a user object (dictionary)</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>username: The username of the user</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_user" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_user">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_user</span><span class="signature">(self, username, **kwargs) -&gt; dict</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the full exposed user object</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username of the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://tiktok.com/@</span><span class="si">{}</span><span class="s2">?lang=en&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/@</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Tiktok response is empty&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Tiktok response: </span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">TikTokCaptchaError</span><span class="p">()</span>

        <span class="n">user</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;serverCode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span>
                <span class="s2">&quot;TikTok user with username </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">user</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets the full exposed user object</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>username: The username of the user</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_video_by_tiktok" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_video_by_tiktok">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_video_by_tiktok</span><span class="signature">(self, data, **kwargs) -&gt; bytes</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_video_by_tiktok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads video from TikTok using a TikTok object.</span>

<span class="sd">        You will need to set a custom_device_id to do this for anything but trending.</span>
<span class="sd">        To do this, this is pretty simple you can either generate one yourself or,</span>
<span class="sd">        you can pass the generate_static_device_id=True into the constructor of the</span>
<span class="sd">        TikTokApi class.</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * data: A TikTok object</span>

<span class="sd">            A TikTok JSON object from any other method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;downloadAddr&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;itemInfos&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;urls&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">api_url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;itemInfo&quot;</span><span class="p">][</span><span class="s2">&quot;itemStruct&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;playAddr&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_video_by_download_url</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Downloads video from TikTok using a TikTok object.</p>

<p>You will need to set a custom_device_id to do this for anything but trending.
To do this, this is pretty simple you can either generate one yourself or,
you can pass the generate_static_device_id=True into the constructor of the
TikTokApi class.</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>data: A TikTok object</p>

<p>A TikTok JSON object from any other method.</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_video_by_download_url" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_video_by_download_url">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_video_by_download_url</span><span class="signature">(self, download_url, **kwargs) -&gt; bytes</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_video_by_download_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads video from TikTok using download url in a TikTok object</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * download_url: The download url key value in a TikTok object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Downloads video from TikTok using download url in a TikTok object</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>download_url: The download url key value in a TikTok object</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_video_by_url" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_video_by_url">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_video_by_url</span><span class="signature">(self, video_url, **kwargs) -&gt; bytes</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_video_by_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Downloads a TikTok video by a URL</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * video_url: The TikTok url to download the video from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="n">tiktok_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tiktok_by_url</span><span class="p">(</span><span class="n">video_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">download_url</span> <span class="o">=</span> <span class="n">tiktok_schema</span><span class="p">[</span><span class="s2">&quot;itemInfo&quot;</span><span class="p">][</span><span class="s2">&quot;itemStruct&quot;</span><span class="p">][</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;downloadAddr&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Downloads a TikTok video by a URL</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>video_url: The TikTok url to download the video from</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_video_no_watermark" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_video_no_watermark">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_video_no_watermark</span><span class="signature">(self, video_url, return_bytes=1, **kwargs) -&gt; bytes</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_video_no_watermark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_url</span><span class="p">,</span> <span class="n">return_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the video with no watermark</span>
<span class="sd">        .. deprecated::</span>

<span class="sd">        Deprecated due to TikTok fixing this</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * video_url: The url of the video you want to download</span>

<span class="sd">        * return_bytes: Set this to 0 if you want url, 1 if you want bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">region</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">maxCount</span><span class="p">,</span>
            <span class="n">device_id</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_kwargs__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Deprecated method, TikTok fixed this.&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets the video with no watermark
.. deprecated::</p>

<p>Deprecated due to TikTok fixing this</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li><p>video_url: The url of the video you want to download</p></li>
<li><p>return_bytes: Set this to 0 if you want url, 1 if you want bytes</p></li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_music_title" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_music_title">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_music_title</span><span class="signature">(self, id, **kwargs)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_music_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves a music title given an ID</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * id: The music id to get the title for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://www.tiktok.com/music/-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
        <span class="n">j_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extract_tag_contents</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">music_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_raw</span><span class="p">)[</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;pageProps&quot;</span><span class="p">][</span><span class="s2">&quot;musicInfo&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">music_object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TikTokNotFoundError</span><span class="p">(</span><span class="s2">&quot;Song of </span><span class="si">{}</span><span class="s2"> id does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">music_object</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves a music title given an ID</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>id: The music id to get the title for</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.get_secuid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.get_secuid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_secuid</span><span class="signature">(self, username, **kwargs)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_secuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the secUid for a specific username</span>

<span class="sd">        ##### Parameters</span>
<span class="sd">        * username: The username to get the secUid for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://tiktok.com/@</span><span class="si">{}</span><span class="s2">?lang=en&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/@</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)),</span>
                <span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip, deflate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__format_proxy</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">requests_extra_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;secUid&quot;:&quot;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;,&quot;secret&quot;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Retrieving the user secUid failed. Likely due to TikTok wanting captcha validation. Try to use a proxy.&quot;</span>
            <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets the secUid for a specific username</p>

<h5 id="parameters">Parameters</h5>

<ul>
<li>username: The username to get the secUid for</li>
</ul>
</div>


                            </div>
                            <div id="TikTokApi.generate_device_id" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#TikTokApi.generate_device_id">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">generate_device_id</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_device_id</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Generates a valid device_id for other methods. Pass this as the custom_device_id field to download videos&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)])</span>
</pre></div>

        </details>

            <div class="docstring"><p>Generates a valid device_id for other methods. Pass this as the custom_device_id field to download videos</p>
</div>


                            </div>
                </section>
    </main>
            <script>/** elasticlunr - http://weixsong.github.io * Copyright (C) 2017 Oliver Nightingale * Copyright (C) 2017 Wei Song * MIT Licensed */!function(){function e(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var t=function(e){var n=new t.Index;return n.pipeline.add(t.trimmer,t.stopWordFilter,t.stemmer),e&&e.call(n,n),n};t.version="0.9.5",lunr=t,t.utils={},t.utils.warn=function(e){return function(t){e.console&&console.warn&&console.warn(t)}}(this),t.utils.toString=function(e){return void 0===e||null===e?"":e.toString()},t.EventEmitter=function(){this.events={}},t.EventEmitter.prototype.addListener=function(){var e=Array.prototype.slice.call(arguments),t=e.pop(),n=e;if("function"!=typeof t)throw new TypeError("last argument must be a function");n.forEach(function(e){this.hasHandler(e)||(this.events[e]=[]),this.events[e].push(t)},this)},t.EventEmitter.prototype.removeListener=function(e,t){if(this.hasHandler(e)){var n=this.events[e].indexOf(t);-1!==n&&(this.events[e].splice(n,1),0==this.events[e].length&&delete this.events[e])}},t.EventEmitter.prototype.emit=function(e){if(this.hasHandler(e)){var t=Array.prototype.slice.call(arguments,1);this.events[e].forEach(function(e){e.apply(void 0,t)},this)}},t.EventEmitter.prototype.hasHandler=function(e){return e in this.events},t.tokenizer=function(e){if(!arguments.length||null===e||void 0===e)return[];if(Array.isArray(e)){var n=e.filter(function(e){return null===e||void 0===e?!1:!0});n=n.map(function(e){return t.utils.toString(e).toLowerCase()});var i=[];return n.forEach(function(e){var n=e.split(t.tokenizer.seperator);i=i.concat(n)},this),i}return e.toString().trim().toLowerCase().split(t.tokenizer.seperator)},t.tokenizer.defaultSeperator=/[\s\-]+/,t.tokenizer.seperator=t.tokenizer.defaultSeperator,t.tokenizer.setSeperator=function(e){null!==e&&void 0!==e&&"object"==typeof e&&(t.tokenizer.seperator=e)},t.tokenizer.resetSeperator=function(){t.tokenizer.seperator=t.tokenizer.defaultSeperator},t.tokenizer.getSeperator=function(){return t.tokenizer.seperator},t.Pipeline=function(){this._queue=[]},t.Pipeline.registeredFunctions={},t.Pipeline.registerFunction=function(e,n){n in t.Pipeline.registeredFunctions&&t.utils.warn("Overwriting existing registered function: "+n),e.label=n,t.Pipeline.registeredFunctions[n]=e},t.Pipeline.getRegisteredFunction=function(e){return e in t.Pipeline.registeredFunctions!=!0?null:t.Pipeline.registeredFunctions[e]},t.Pipeline.warnIfFunctionNotRegistered=function(e){var n=e.label&&e.label in this.registeredFunctions;n||t.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},t.Pipeline.load=function(e){var n=new t.Pipeline;return e.forEach(function(e){var i=t.Pipeline.getRegisteredFunction(e);if(!i)throw new Error("Cannot load un-registered function: "+e);n.add(i)}),n},t.Pipeline.prototype.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(e){t.Pipeline.warnIfFunctionNotRegistered(e),this._queue.push(e)},this)},t.Pipeline.prototype.after=function(e,n){t.Pipeline.warnIfFunctionNotRegistered(n);var i=this._queue.indexOf(e);if(-1===i)throw new Error("Cannot find existingFn");this._queue.splice(i+1,0,n)},t.Pipeline.prototype.before=function(e,n){t.Pipeline.warnIfFunctionNotRegistered(n);var i=this._queue.indexOf(e);if(-1===i)throw new Error("Cannot find existingFn");this._queue.splice(i,0,n)},t.Pipeline.prototype.remove=function(e){var t=this._queue.indexOf(e);-1!==t&&this._queue.splice(t,1)},t.Pipeline.prototype.run=function(e){for(var t=[],n=e.length,i=this._queue.length,o=0;n>o;o++){for(var r=e[o],s=0;i>s&&(r=this._queue[s](r,o,e),void 0!==r&&null!==r);s++);void 0!==r&&null!==r&&t.push(r)}return t},t.Pipeline.prototype.reset=function(){this._queue=[]},t.Pipeline.prototype.get=function(){return this._queue},t.Pipeline.prototype.toJSON=function(){return this._queue.map(function(e){return t.Pipeline.warnIfFunctionNotRegistered(e),e.label})},t.Index=function(){this._fields=[],this._ref="id",this.pipeline=new t.Pipeline,this.documentStore=new t.DocumentStore,this.index={},this.eventEmitter=new t.EventEmitter,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},t.Index.prototype.on=function(){var e=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,e)},t.Index.prototype.off=function(e,t){return this.eventEmitter.removeListener(e,t)},t.Index.load=function(e){e.version!==t.version&&t.utils.warn("version mismatch: current "+t.version+" importing "+e.version);var n=new this;n._fields=e.fields,n._ref=e.ref,n.documentStore=t.DocumentStore.load(e.documentStore),n.pipeline=t.Pipeline.load(e.pipeline),n.index={};for(var i in e.index)n.index[i]=t.InvertedIndex.load(e.index[i]);return n},t.Index.prototype.addField=function(e){return this._fields.push(e),this.index[e]=new t.InvertedIndex,this},t.Index.prototype.setRef=function(e){return this._ref=e,this},t.Index.prototype.saveDocument=function(e){return this.documentStore=new t.DocumentStore(e),this},t.Index.prototype.addDoc=function(e,n){if(e){var n=void 0===n?!0:n,i=e[this._ref];this.documentStore.addDoc(i,e),this._fields.forEach(function(n){var o=this.pipeline.run(t.tokenizer(e[n]));this.documentStore.addFieldLength(i,n,o.length);var r={};o.forEach(function(e){e in r?r[e]+=1:r[e]=1},this);for(var s in r){var u=r[s];u=Math.sqrt(u),this.index[n].addToken(s,{ref:i,tf:u})}},this),n&&this.eventEmitter.emit("add",e,this)}},t.Index.prototype.removeDocByRef=function(e){if(e&&this.documentStore.isDocStored()!==!1&&this.documentStore.hasDoc(e)){var t=this.documentStore.getDoc(e);this.removeDoc(t,!1)}},t.Index.prototype.removeDoc=function(e,n){if(e){var n=void 0===n?!0:n,i=e[this._ref];this.documentStore.hasDoc(i)&&(this.documentStore.removeDoc(i),this._fields.forEach(function(n){var o=this.pipeline.run(t.tokenizer(e[n]));o.forEach(function(e){this.index[n].removeToken(e,i)},this)},this),n&&this.eventEmitter.emit("remove",e,this))}},t.Index.prototype.updateDoc=function(e,t){var t=void 0===t?!0:t;this.removeDocByRef(e[this._ref],!1),this.addDoc(e,!1),t&&this.eventEmitter.emit("update",e,this)},t.Index.prototype.idf=function(e,t){var n="@"+t+"/"+e;if(Object.prototype.hasOwnProperty.call(this._idfCache,n))return this._idfCache[n];var i=this.index[t].getDocFreq(e),o=1+Math.log(this.documentStore.length/(i+1));return this._idfCache[n]=o,o},t.Index.prototype.getFields=function(){return this._fields.slice()},t.Index.prototype.search=function(e,n){if(!e)return[];e="string"==typeof e?{any:e}:JSON.parse(JSON.stringify(e));var i=null;null!=n&&(i=JSON.stringify(n));for(var o=new t.Configuration(i,this.getFields()).get(),r={},s=Object.keys(e),u=0;u<s.length;u++){var a=s[u];r[a]=this.pipeline.run(t.tokenizer(e[a]))}var l={};for(var c in o){var d=r[c]||r.any;if(d){var f=this.fieldSearch(d,c,o),h=o[c].boost;for(var p in f)f[p]=f[p]*h;for(var p in f)p in l?l[p]+=f[p]:l[p]=f[p]}}var v,g=[];for(var p in l)v={ref:p,score:l[p]},this.documentStore.hasDoc(p)&&(v.doc=this.documentStore.getDoc(p)),g.push(v);return g.sort(function(e,t){return t.score-e.score}),g},t.Index.prototype.fieldSearch=function(e,t,n){var i=n[t].bool,o=n[t].expand,r=n[t].boost,s=null,u={};return 0!==r?(e.forEach(function(e){var n=[e];1==o&&(n=this.index[t].expandToken(e));var r={};n.forEach(function(n){var o=this.index[t].getDocs(n),a=this.idf(n,t);if(s&&"AND"==i){var l={};for(var c in s)c in o&&(l[c]=o[c]);o=l}n==e&&this.fieldSearchStats(u,n,o);for(var c in o){var d=this.index[t].getTermFrequency(n,c),f=this.documentStore.getFieldLength(c,t),h=1;0!=f&&(h=1/Math.sqrt(f));var p=1;n!=e&&(p=.15*(1-(n.length-e.length)/n.length));var v=d*a*h*p;c in r?r[c]+=v:r[c]=v}},this),s=this.mergeScores(s,r,i)},this),s=this.coordNorm(s,u,e.length)):void 0},t.Index.prototype.mergeScores=function(e,t,n){if(!e)return t;if("AND"==n){var i={};for(var o in t)o in e&&(i[o]=e[o]+t[o]);return i}for(var o in t)o in e?e[o]+=t[o]:e[o]=t[o];return e},t.Index.prototype.fieldSearchStats=function(e,t,n){for(var i in n)i in e?e[i].push(t):e[i]=[t]},t.Index.prototype.coordNorm=function(e,t,n){for(var i in e)if(i in t){var o=t[i].length;e[i]=e[i]*o/n}return e},t.Index.prototype.toJSON=function(){var e={};return this._fields.forEach(function(t){e[t]=this.index[t].toJSON()},this),{version:t.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),index:e,pipeline:this.pipeline.toJSON()}},t.Index.prototype.use=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this),e.apply(this,t)},t.DocumentStore=function(e){this._save=null===e||void 0===e?!0:e,this.docs={},this.docInfo={},this.length=0},t.DocumentStore.load=function(e){var t=new this;return t.length=e.length,t.docs=e.docs,t.docInfo=e.docInfo,t._save=e.save,t},t.DocumentStore.prototype.isDocStored=function(){return this._save},t.DocumentStore.prototype.addDoc=function(t,n){this.hasDoc(t)||this.length++,this.docs[t]=this._save===!0?e(n):null},t.DocumentStore.prototype.getDoc=function(e){return this.hasDoc(e)===!1?null:this.docs[e]},t.DocumentStore.prototype.hasDoc=function(e){return e in this.docs},t.DocumentStore.prototype.removeDoc=function(e){this.hasDoc(e)&&(delete this.docs[e],delete this.docInfo[e],this.length--)},t.DocumentStore.prototype.addFieldLength=function(e,t,n){null!==e&&void 0!==e&&0!=this.hasDoc(e)&&(this.docInfo[e]||(this.docInfo[e]={}),this.docInfo[e][t]=n)},t.DocumentStore.prototype.updateFieldLength=function(e,t,n){null!==e&&void 0!==e&&0!=this.hasDoc(e)&&this.addFieldLength(e,t,n)},t.DocumentStore.prototype.getFieldLength=function(e,t){return null===e||void 0===e?0:e in this.docs&&t in this.docInfo[e]?this.docInfo[e][t]:0},t.DocumentStore.prototype.toJSON=function(){return{docs:this.docs,docInfo:this.docInfo,length:this.length,save:this._save}},t.stemmer=function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},n="[^aeiou]",i="[aeiouy]",o=n+"[^aeiouy]*",r=i+"[aeiou]*",s="^("+o+")?"+r+o,u="^("+o+")?"+r+o+"("+r+")?$",a="^("+o+")?"+r+o+r+o,l="^("+o+")?"+i,c=new RegExp(s),d=new RegExp(a),f=new RegExp(u),h=new RegExp(l),p=/^(.+?)(ss|i)es$/,v=/^(.+?)([^s])s$/,g=/^(.+?)eed$/,m=/^(.+?)(ed|ing)$/,y=/.$/,S=/(at|bl|iz)$/,x=new RegExp("([^aeiouylsz])\\1$"),w=new RegExp("^"+o+i+"[^aeiouwxy]$"),I=/^(.+?[^aeiou])y$/,b=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,E=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,D=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,F=/^(.+?)(s|t)(ion)$/,_=/^(.+?)e$/,P=/ll$/,k=new RegExp("^"+o+i+"[^aeiouwxy]$"),z=function(n){var i,o,r,s,u,a,l;if(n.length<3)return n;if(r=n.substr(0,1),"y"==r&&(n=r.toUpperCase()+n.substr(1)),s=p,u=v,s.test(n)?n=n.replace(s,"$1$2"):u.test(n)&&(n=n.replace(u,"$1$2")),s=g,u=m,s.test(n)){var z=s.exec(n);s=c,s.test(z[1])&&(s=y,n=n.replace(s,""))}else if(u.test(n)){var z=u.exec(n);i=z[1],u=h,u.test(i)&&(n=i,u=S,a=x,l=w,u.test(n)?n+="e":a.test(n)?(s=y,n=n.replace(s,"")):l.test(n)&&(n+="e"))}if(s=I,s.test(n)){var z=s.exec(n);i=z[1],n=i+"i"}if(s=b,s.test(n)){var z=s.exec(n);i=z[1],o=z[2],s=c,s.test(i)&&(n=i+e[o])}if(s=E,s.test(n)){var z=s.exec(n);i=z[1],o=z[2],s=c,s.test(i)&&(n=i+t[o])}if(s=D,u=F,s.test(n)){var z=s.exec(n);i=z[1],s=d,s.test(i)&&(n=i)}else if(u.test(n)){var z=u.exec(n);i=z[1]+z[2],u=d,u.test(i)&&(n=i)}if(s=_,s.test(n)){var z=s.exec(n);i=z[1],s=d,u=f,a=k,(s.test(i)||u.test(i)&&!a.test(i))&&(n=i)}return s=P,u=d,s.test(n)&&u.test(n)&&(s=y,n=n.replace(s,"")),"y"==r&&(n=r.toLowerCase()+n.substr(1)),n};return z}(),t.Pipeline.registerFunction(t.stemmer,"stemmer"),t.stopWordFilter=function(e){return e&&t.stopWordFilter.stopWords[e]!==!0?e:void 0},t.clearStopWords=function(){t.stopWordFilter.stopWords={}},t.addStopWords=function(e){null!=e&&Array.isArray(e)!==!1&&e.forEach(function(e){t.stopWordFilter.stopWords[e]=!0},this)},t.resetStopWords=function(){t.stopWordFilter.stopWords=t.defaultStopWords},t.defaultStopWords={"":!0,a:!0,able:!0,about:!0,across:!0,after:!0,all:!0,almost:!0,also:!0,am:!0,among:!0,an:!0,and:!0,any:!0,are:!0,as:!0,at:!0,be:!0,because:!0,been:!0,but:!0,by:!0,can:!0,cannot:!0,could:!0,dear:!0,did:!0,"do":!0,does:!0,either:!0,"else":!0,ever:!0,every:!0,"for":!0,from:!0,get:!0,got:!0,had:!0,has:!0,have:!0,he:!0,her:!0,hers:!0,him:!0,his:!0,how:!0,however:!0,i:!0,"if":!0,"in":!0,into:!0,is:!0,it:!0,its:!0,just:!0,least:!0,let:!0,like:!0,likely:!0,may:!0,me:!0,might:!0,most:!0,must:!0,my:!0,neither:!0,no:!0,nor:!0,not:!0,of:!0,off:!0,often:!0,on:!0,only:!0,or:!0,other:!0,our:!0,own:!0,rather:!0,said:!0,say:!0,says:!0,she:!0,should:!0,since:!0,so:!0,some:!0,than:!0,that:!0,the:!0,their:!0,them:!0,then:!0,there:!0,these:!0,they:!0,"this":!0,tis:!0,to:!0,too:!0,twas:!0,us:!0,wants:!0,was:!0,we:!0,were:!0,what:!0,when:!0,where:!0,which:!0,"while":!0,who:!0,whom:!0,why:!0,will:!0,"with":!0,would:!0,yet:!0,you:!0,your:!0},t.stopWordFilter.stopWords=t.defaultStopWords,t.Pipeline.registerFunction(t.stopWordFilter,"stopWordFilter"),t.trimmer=function(e){if(null===e||void 0===e)throw new Error("token should not be undefined");return e.replace(/^\W+/,"").replace(/\W+$/,"")},t.Pipeline.registerFunction(t.trimmer,"trimmer"),t.InvertedIndex=function(){this.root={docs:{},df:0}},t.InvertedIndex.load=function(e){var t=new this;return t.root=e.root,t},t.InvertedIndex.prototype.addToken=function(e,t,n){for(var n=n||this.root,i=0;i<=e.length-1;){var o=e[i];o in n||(n[o]={docs:{},df:0}),i+=1,n=n[o]}var r=t.ref;n.docs[r]?n.docs[r]={tf:t.tf}:(n.docs[r]={tf:t.tf},n.df+=1)},t.InvertedIndex.prototype.hasToken=function(e){if(!e)return!1;for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return!1;t=t[e[n]]}return!0},t.InvertedIndex.prototype.getNode=function(e){if(!e)return null;for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return null;t=t[e[n]]}return t},t.InvertedIndex.prototype.getDocs=function(e){var t=this.getNode(e);return null==t?{}:t.docs},t.InvertedIndex.prototype.getTermFrequency=function(e,t){var n=this.getNode(e);return null==n?0:t in n.docs?n.docs[t].tf:0},t.InvertedIndex.prototype.getDocFreq=function(e){var t=this.getNode(e);return null==t?0:t.df},t.InvertedIndex.prototype.removeToken=function(e,t){if(e){var n=this.getNode(e);null!=n&&t in n.docs&&(delete n.docs[t],n.df-=1)}},t.InvertedIndex.prototype.expandToken=function(e,t,n){if(null==e||""==e)return[];var t=t||[];if(void 0==n&&(n=this.getNode(e),null==n))return t;n.df>0&&t.push(e);for(var i in n)"docs"!==i&&"df"!==i&&this.expandToken(e+i,t,n[i]);return t},t.InvertedIndex.prototype.toJSON=function(){return{root:this.root}},t.Configuration=function(e,n){var e=e||"";if(void 0==n||null==n)throw new Error("fields should not be null");this.config={};var i;try{i=JSON.parse(e),this.buildUserConfig(i,n)}catch(o){t.utils.warn("user configuration parse failed, will use default configuration"),this.buildDefaultConfig(n)}},t.Configuration.prototype.buildDefaultConfig=function(e){this.reset(),e.forEach(function(e){this.config[e]={boost:1,bool:"OR",expand:!1}},this)},t.Configuration.prototype.buildUserConfig=function(e,n){var i="OR",o=!1;if(this.reset(),"bool"in e&&(i=e.bool||i),"expand"in e&&(o=e.expand||o),"fields"in e)for(var r in e.fields)if(n.indexOf(r)>-1){var s=e.fields[r],u=o;void 0!=s.expand&&(u=s.expand),this.config[r]={boost:s.boost||0===s.boost?s.boost:1,bool:s.bool||i,expand:u}}else t.utils.warn("field name in user configuration not found in index instance fields");else this.addAllFields2UserConfig(i,o,n)},t.Configuration.prototype.addAllFields2UserConfig=function(e,t,n){n.forEach(function(n){this.config[n]={boost:1,bool:e,expand:t}},this)},t.Configuration.prototype.get=function(){return this.config},t.Configuration.prototype.reset=function(){this.config={}},lunr.SortedSet=function(){this.length=0,this.elements=[]},lunr.SortedSet.load=function(e){var t=new this;return t.elements=e,t.length=e.length,t},lunr.SortedSet.prototype.add=function(){var e,t;for(e=0;e<arguments.length;e++)t=arguments[e],~this.indexOf(t)||this.elements.splice(this.locationFor(t),0,t);this.length=this.elements.length},lunr.SortedSet.prototype.toArray=function(){return this.elements.slice()},lunr.SortedSet.prototype.map=function(e,t){return this.elements.map(e,t)},lunr.SortedSet.prototype.forEach=function(e,t){return this.elements.forEach(e,t)},lunr.SortedSet.prototype.indexOf=function(e){for(var t=0,n=this.elements.length,i=n-t,o=t+Math.floor(i/2),r=this.elements[o];i>1;){if(r===e)return o;e>r&&(t=o),r>e&&(n=o),i=n-t,o=t+Math.floor(i/2),r=this.elements[o]}return r===e?o:-1},lunr.SortedSet.prototype.locationFor=function(e){for(var t=0,n=this.elements.length,i=n-t,o=t+Math.floor(i/2),r=this.elements[o];i>1;)e>r&&(t=o),r>e&&(n=o),i=n-t,o=t+Math.floor(i/2),r=this.elements[o];return r>e?o:e>r?o+1:void 0},lunr.SortedSet.prototype.intersect=function(e){for(var t=new lunr.SortedSet,n=0,i=0,o=this.length,r=e.length,s=this.elements,u=e.elements;;){if(n>o-1||i>r-1)break;s[n]!==u[i]?s[n]<u[i]?n++:s[n]>u[i]&&i++:(t.add(s[n]),n++,i++)}return t},lunr.SortedSet.prototype.clone=function(){var e=new lunr.SortedSet;return e.elements=this.toArray(),e.length=e.elements.length,e},lunr.SortedSet.prototype.union=function(e){var t,n,i;this.length>=e.length?(t=this,n=e):(t=e,n=this),i=t.clone();for(var o=0,r=n.toArray();o<r.length;o++)i.add(r[o]);return i},lunr.SortedSet.prototype.toJSON=function(){return this.toArray()},function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.elasticlunr=t()}(this,function(){return t})}();</script>
            <script>
                function escapeHTML(html) {
                    return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
                }

                const originalContent = document.querySelector("main.pdoc");
                let currentContent = originalContent;

                function setContent(innerHTML) {
                    let elem;
                    if (innerHTML) {
                        elem = document.createElement("main");
                        elem.classList.add("pdoc");
                        elem.innerHTML = innerHTML;
                    } else {
                        elem = originalContent;
                    }
                    if (currentContent !== elem) {
                        currentContent.replaceWith(elem);
                        currentContent = elem;
                    }
                }

                function getSearchTerm() {
                    return (new URL(window.location)).searchParams.get("search");
                }

                const searchBox = document.querySelector(".pdoc input[type=search]");
                searchBox.addEventListener("input", function () {
                    let url = new URL(window.location);
                    if (searchBox.value.trim()) {
                        url.hash = "";
                        url.searchParams.set("search", searchBox.value);
                    } else {
                        url.searchParams.delete("search");
                    }
                    history.replaceState("", "", url.toString());
                    onInput();
                });
                window.addEventListener("popstate", onInput);


                let searchIndex, searchErr;

                async function initialize() {
                    let docs;
                    try {
                        let resp = await fetch("../search.json");
                        docs = await resp.json();
                    } catch (e) {
                        searchErr = "Cannot fetch search index.";
                        throw e;
                    }

                    // Also split on html tags. this is a cheap heuristic, but good enough.
                    elasticlunr.tokenizer.setSeperator(/[\s\-.;&]+|<[^>]*>/);

                    if (docs._isPrebuiltIndex) {
                        console.info("using precompiled search index");
                        searchIndex = elasticlunr.Index.load(docs);
                    } else {
                        console.time("building search index");
                        searchIndex = elasticlunr(function () {
                            this.addField('qualname');
                            this.addField('fullname');
                            this.addField('doc');
                            this.setRef('fullname');
                        });
                        for (let doc of docs) {
                            searchIndex.addDoc(doc);
                        }
                        console.timeEnd("building search index");
                    }
                    onInput();

                    document.querySelector("nav.pdoc").addEventListener("click", e => {
                        if (e.target.hash) {
                            searchBox.value = "";
                            searchBox.dispatchEvent(new Event("input"));
                        }
                    });
                }

                function onInput() {
                    setContent((() => {
                        const search = getSearchTerm();
                        if (!search) {
                            return null
                        }
                        if (searchErr) {
                            return `<h3>Error: ${searchErr}</h3>`
                        }
                        if (!searchIndex) {
                            return "<h3>Searching...</h3>"
                        }

                        window.scrollTo({top: 0, left: 0, behavior: 'auto'});

                        const results = searchIndex.search(search, {
                            fields: {
                                qualname: {boost: 4},
                                fullname: {boost: 2},
                                doc: {boost: 1},
                            },
                            expand: true
                        });

                        let html;
                        if (results.length === 0) {
                            html = `No search results for '${escapeHTML(search)}'.`
                        } else {
                            html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(search)}'.</h4>`;
                        }
                        for (let result of results.slice(0, 10)) {
                            let doc = result.doc;
                            let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                            if (doc.qualname) {
                                url += `#${doc.qualname}`;
                            }

                            let heading;
                            switch (result.doc.type) {
                                case "function":
                                    heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">(${doc.parameters.join(", ")})</span>`;
                                    break;
                                case "class":
                                    heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                                    break;
                                default:
                                    heading = `<span class="name">${doc.fullname}</span>`;
                                    break;
                            }
                            html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

                        }
                        return html;
                    })());
                }

                if (getSearchTerm()) {
                    initialize();
                    searchBox.value = getSearchTerm();
                    onInput();
                } else {
                    searchBox.addEventListener("focus", initialize, {once: true});
                }

                searchBox.addEventListener("keydown", e => {
                    if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
                        let focused = currentContent.querySelector(".search-result.focused");
                        if (!focused) {
                            currentContent.querySelector(".search-result").classList.add("focused");
                        } else if (
                            e.key === "ArrowDown"
                            && focused.nextElementSibling
                            && focused.nextElementSibling.classList.contains("search-result")
                        ) {
                            focused.classList.remove("focused");
                            focused.nextElementSibling.classList.add("focused");
                            focused.nextElementSibling.scrollIntoView({
                                behavior: "smooth",
                                block: "nearest",
                                inline: "nearest"
                            });
                        } else if (
                            e.key === "ArrowUp"
                            && focused.previousElementSibling
                            && focused.previousElementSibling.classList.contains("search-result")
                        ) {
                            focused.classList.remove("focused");
                            focused.previousElementSibling.classList.add("focused");
                            focused.previousElementSibling.scrollIntoView({
                                behavior: "smooth",
                                block: "nearest",
                                inline: "nearest"
                            });
                        } else if (
                            e.key === "Enter"
                        ) {
                            focused.querySelector("a").click();
                        }
                    }
                });
            </script>
</body>
</html>